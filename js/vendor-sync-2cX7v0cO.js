import{p as Fn,i as Yn,S as Jn,n as Kn,O as en,c as xe,u as $n,f as P,s as j,m as M,a as $t,b as Ot,d as Hn,g as zn,e as qn,h as Nt,j as nn,k as wt,l as Gn,o as Ht,w as sn,q as jn,r as B,t as se,v as Wn,x as Qn,y as Xn,B as Me,z as zt,A as Be,C as qt,D as Ut,E as $,F as H,G as ut,I as Gt,U as jt,R as Ve,H as ie,J as Zn,K as y,L as R,M as K,N as rn,P as re,Q as oe,T as Pn,V as ts,W as es,X as ns,Y as ss,Z as is,_ as Wt,$ as rs,a0 as we,a1 as Qt,a2 as Ft,a3 as rt,a4 as os,a5 as k,a6 as ce,a7 as Xt,a8 as le,a9 as cs,aa as v,ab as Zt,ac as Pt,ad as Ue,ae as ls,af as hs,ag as Fe,ah as as,ai as us}from"./vendor-ClHxvuXm.js";function A(s){if(s)return ds(s)}function ds(s){for(var t in A.prototype)s[t]=A.prototype[t];return s}A.prototype.on=A.prototype.addEventListener=function(s,t){return this._callbacks=this._callbacks||{},(this._callbacks["$"+s]=this._callbacks["$"+s]||[]).push(t),this};A.prototype.once=function(s,t){function e(){this.off(s,e),t.apply(this,arguments)}return e.fn=t,this.on(s,e),this};A.prototype.off=A.prototype.removeListener=A.prototype.removeAllListeners=A.prototype.removeEventListener=function(s,t){if(this._callbacks=this._callbacks||{},arguments.length==0)return this._callbacks={},this;var e=this._callbacks["$"+s];if(!e)return this;if(arguments.length==1)return delete this._callbacks["$"+s],this;for(var n,i=0;i<e.length;i++)if(n=e[i],n===t||n.fn===t){e.splice(i,1);break}return e.length===0&&delete this._callbacks["$"+s],this};A.prototype.emit=function(s){this._callbacks=this._callbacks||{};for(var t=new Array(arguments.length-1),e=this._callbacks["$"+s],n=1;n<arguments.length;n++)t[n-1]=arguments[n];if(e){e=e.slice(0);for(var n=0,i=e.length;n<i;++n)e[n].apply(this,t)}return this};A.prototype.emitReserved=A.prototype.emit;A.prototype.listeners=function(s){return this._callbacks=this._callbacks||{},this._callbacks["$"+s]||[]};A.prototype.hasListeners=function(s){return!!this.listeners(s).length};function fs(s,t="",e){let n=s;e=e||typeof location<"u"&&location,s==null&&(s=e.protocol+"//"+e.host),typeof s=="string"&&(s.charAt(0)==="/"&&(s.charAt(1)==="/"?s=e.protocol+s:s=e.host+s),/^(https?|wss?):\/\//.test(s)||(typeof e<"u"?s=e.protocol+"//"+s:s="https://"+s),n=Fn(s)),n.port||(/^(http|ws)$/.test(n.protocol)?n.port="80":/^(http|ws)s$/.test(n.protocol)&&(n.port="443")),n.path=n.path||"/";const r=n.host.indexOf(":")!==-1?"["+n.host+"]":n.host;return n.id=n.protocol+"://"+r+":"+n.port+t,n.href=n.protocol+"://"+r+(e&&e.port===n.port?"":":"+n.port),n}const gs=typeof ArrayBuffer=="function",ps=s=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(s):s.buffer instanceof ArrayBuffer,on=Object.prototype.toString,ws=typeof Blob=="function"||typeof Blob<"u"&&on.call(Blob)==="[object BlobConstructor]",ms=typeof File=="function"||typeof File<"u"&&on.call(File)==="[object FileConstructor]";function me(s){return gs&&(s instanceof ArrayBuffer||ps(s))||ws&&s instanceof Blob||ms&&s instanceof File}function Dt(s,t){if(!s||typeof s!="object")return!1;if(Array.isArray(s)){for(let e=0,n=s.length;e<n;e++)if(Dt(s[e]))return!0;return!1}if(me(s))return!0;if(s.toJSON&&typeof s.toJSON=="function"&&arguments.length===1)return Dt(s.toJSON(),!0);for(const e in s)if(Object.prototype.hasOwnProperty.call(s,e)&&Dt(s[e]))return!0;return!1}function ks(s){const t=[],e=s.data,n=s;return n.data=he(e,t),n.attachments=t.length,{packet:n,buffers:t}}function he(s,t){if(!s)return s;if(me(s)){const e={_placeholder:!0,num:t.length};return t.push(s),e}else if(Array.isArray(s)){const e=new Array(s.length);for(let n=0;n<s.length;n++)e[n]=he(s[n],t);return e}else if(typeof s=="object"&&!(s instanceof Date)){const e={};for(const n in s)Object.prototype.hasOwnProperty.call(s,n)&&(e[n]=he(s[n],t));return e}return s}function _s(s,t){return s.data=ae(s.data,t),delete s.attachments,s}function ae(s,t){if(!s)return s;if(s&&s._placeholder===!0){if(typeof s.num=="number"&&s.num>=0&&s.num<t.length)return t[s.num];throw new Error("illegal attachments")}else if(Array.isArray(s))for(let e=0;e<s.length;e++)s[e]=ae(s[e],t);else if(typeof s=="object")for(const e in s)Object.prototype.hasOwnProperty.call(s,e)&&(s[e]=ae(s[e],t));return s}const ys=["connect","connect_error","disconnect","disconnecting","newListener","removeListener"],bs=5;var m;(function(s){s[s.CONNECT=0]="CONNECT",s[s.DISCONNECT=1]="DISCONNECT",s[s.EVENT=2]="EVENT",s[s.ACK=3]="ACK",s[s.CONNECT_ERROR=4]="CONNECT_ERROR",s[s.BINARY_EVENT=5]="BINARY_EVENT",s[s.BINARY_ACK=6]="BINARY_ACK"})(m||(m={}));class Ss{constructor(t){this.replacer=t}encode(t){return(t.type===m.EVENT||t.type===m.ACK)&&Dt(t)?this.encodeAsBinary({type:t.type===m.EVENT?m.BINARY_EVENT:m.BINARY_ACK,nsp:t.nsp,data:t.data,id:t.id}):[this.encodeAsString(t)]}encodeAsString(t){let e=""+t.type;return(t.type===m.BINARY_EVENT||t.type===m.BINARY_ACK)&&(e+=t.attachments+"-"),t.nsp&&t.nsp!=="/"&&(e+=t.nsp+","),t.id!=null&&(e+=t.id),t.data!=null&&(e+=JSON.stringify(t.data,this.replacer)),e}encodeAsBinary(t){const e=ks(t),n=this.encodeAsString(e.packet),i=e.buffers;return i.unshift(n),i}}function Ye(s){return Object.prototype.toString.call(s)==="[object Object]"}class ke extends A{constructor(t){super(),this.reviver=t}add(t){let e;if(typeof t=="string"){if(this.reconstructor)throw new Error("got plaintext data when reconstructing a packet");e=this.decodeString(t);const n=e.type===m.BINARY_EVENT;n||e.type===m.BINARY_ACK?(e.type=n?m.EVENT:m.ACK,this.reconstructor=new Es(e),e.attachments===0&&super.emitReserved("decoded",e)):super.emitReserved("decoded",e)}else if(me(t)||t.base64)if(this.reconstructor)e=this.reconstructor.takeBinaryData(t),e&&(this.reconstructor=null,super.emitReserved("decoded",e));else throw new Error("got binary data when not reconstructing a packet");else throw new Error("Unknown type: "+t)}decodeString(t){let e=0;const n={type:Number(t.charAt(0))};if(m[n.type]===void 0)throw new Error("unknown packet type "+n.type);if(n.type===m.BINARY_EVENT||n.type===m.BINARY_ACK){const r=e+1;for(;t.charAt(++e)!=="-"&&e!=t.length;);const o=t.substring(r,e);if(o!=Number(o)||t.charAt(e)!=="-")throw new Error("Illegal attachments");n.attachments=Number(o)}if(t.charAt(e+1)==="/"){const r=e+1;for(;++e&&!(t.charAt(e)===","||e===t.length););n.nsp=t.substring(r,e)}else n.nsp="/";const i=t.charAt(e+1);if(i!==""&&Number(i)==i){const r=e+1;for(;++e;){const o=t.charAt(e);if(o==null||Number(o)!=o){--e;break}if(e===t.length)break}n.id=Number(t.substring(r,e+1))}if(t.charAt(++e)){const r=this.tryParse(t.substr(e));if(ke.isPayloadValid(n.type,r))n.data=r;else throw new Error("invalid payload")}return n}tryParse(t){try{return JSON.parse(t,this.reviver)}catch{return!1}}static isPayloadValid(t,e){switch(t){case m.CONNECT:return Ye(e);case m.DISCONNECT:return e===void 0;case m.CONNECT_ERROR:return typeof e=="string"||Ye(e);case m.EVENT:case m.BINARY_EVENT:return Array.isArray(e)&&(typeof e[0]=="number"||typeof e[0]=="string"&&ys.indexOf(e[0])===-1);case m.ACK:case m.BINARY_ACK:return Array.isArray(e)}}destroy(){this.reconstructor&&(this.reconstructor.finishedReconstruction(),this.reconstructor=null)}}class Es{constructor(t){this.packet=t,this.buffers=[],this.reconPack=t}takeBinaryData(t){if(this.buffers.push(t),this.buffers.length===this.reconPack.attachments){const e=_s(this.reconPack,this.buffers);return this.finishedReconstruction(),e}return null}finishedReconstruction(){this.reconPack=null,this.buffers=[]}}const Cs=Object.freeze(Object.defineProperty({__proto__:null,Decoder:ke,Encoder:Ss,get PacketType(){return m},protocol:bs},Symbol.toStringTag,{value:"Module"}));function x(s,t,e){return s.on(t,e),function(){s.off(t,e)}}const Ds=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1});class cn extends A{constructor(t,e,n){super(),this.connected=!1,this.recovered=!1,this.receiveBuffer=[],this.sendBuffer=[],this._queue=[],this._queueSeq=0,this.ids=0,this.acks={},this.flags={},this.io=t,this.nsp=e,n&&n.auth&&(this.auth=n.auth),this._opts=Object.assign({},n),this.io._autoConnect&&this.open()}get disconnected(){return!this.connected}subEvents(){if(this.subs)return;const t=this.io;this.subs=[x(t,"open",this.onopen.bind(this)),x(t,"packet",this.onpacket.bind(this)),x(t,"error",this.onerror.bind(this)),x(t,"close",this.onclose.bind(this))]}get active(){return!!this.subs}connect(){return this.connected?this:(this.subEvents(),this.io._reconnecting||this.io.open(),this.io._readyState==="open"&&this.onopen(),this)}open(){return this.connect()}send(...t){return t.unshift("message"),this.emit.apply(this,t),this}emit(t,...e){var n,i,r;if(Ds.hasOwnProperty(t))throw new Error('"'+t.toString()+'" is a reserved event name');if(e.unshift(t),this._opts.retries&&!this.flags.fromQueue&&!this.flags.volatile)return this._addToQueue(e),this;const o={type:m.EVENT,data:e};if(o.options={},o.options.compress=this.flags.compress!==!1,typeof e[e.length-1]=="function"){const h=this.ids++,u=e.pop();this._registerAckCallback(h,u),o.id=h}const c=(i=(n=this.io.engine)===null||n===void 0?void 0:n.transport)===null||i===void 0?void 0:i.writable,l=this.connected&&!(!((r=this.io.engine)===null||r===void 0)&&r._hasPingExpired());return this.flags.volatile&&!c||(l?(this.notifyOutgoingListeners(o),this.packet(o)):this.sendBuffer.push(o)),this.flags={},this}_registerAckCallback(t,e){var n;const i=(n=this.flags.timeout)!==null&&n!==void 0?n:this._opts.ackTimeout;if(i===void 0){this.acks[t]=e;return}const r=this.io.setTimeoutFn(()=>{delete this.acks[t];for(let c=0;c<this.sendBuffer.length;c++)this.sendBuffer[c].id===t&&this.sendBuffer.splice(c,1);e.call(this,new Error("operation has timed out"))},i),o=(...c)=>{this.io.clearTimeoutFn(r),e.apply(this,c)};o.withError=!0,this.acks[t]=o}emitWithAck(t,...e){return new Promise((n,i)=>{const r=(o,c)=>o?i(o):n(c);r.withError=!0,e.push(r),this.emit(t,...e)})}_addToQueue(t){let e;typeof t[t.length-1]=="function"&&(e=t.pop());const n={id:this._queueSeq++,tryCount:0,pending:!1,args:t,flags:Object.assign({fromQueue:!0},this.flags)};t.push((i,...r)=>n!==this._queue[0]?void 0:(i!==null?n.tryCount>this._opts.retries&&(this._queue.shift(),e&&e(i)):(this._queue.shift(),e&&e(null,...r)),n.pending=!1,this._drainQueue())),this._queue.push(n),this._drainQueue()}_drainQueue(t=!1){if(!this.connected||this._queue.length===0)return;const e=this._queue[0];e.pending&&!t||(e.pending=!0,e.tryCount++,this.flags=e.flags,this.emit.apply(this,e.args))}packet(t){t.nsp=this.nsp,this.io._packet(t)}onopen(){typeof this.auth=="function"?this.auth(t=>{this._sendConnectPacket(t)}):this._sendConnectPacket(this.auth)}_sendConnectPacket(t){this.packet({type:m.CONNECT,data:this._pid?Object.assign({pid:this._pid,offset:this._lastOffset},t):t})}onerror(t){this.connected||this.emitReserved("connect_error",t)}onclose(t,e){this.connected=!1,delete this.id,this.emitReserved("disconnect",t,e),this._clearAcks()}_clearAcks(){Object.keys(this.acks).forEach(t=>{if(!this.sendBuffer.some(n=>String(n.id)===t)){const n=this.acks[t];delete this.acks[t],n.withError&&n.call(this,new Error("socket has been disconnected"))}})}onpacket(t){if(t.nsp===this.nsp)switch(t.type){case m.CONNECT:t.data&&t.data.sid?this.onconnect(t.data.sid,t.data.pid):this.emitReserved("connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case m.EVENT:case m.BINARY_EVENT:this.onevent(t);break;case m.ACK:case m.BINARY_ACK:this.onack(t);break;case m.DISCONNECT:this.ondisconnect();break;case m.CONNECT_ERROR:this.destroy();const n=new Error(t.data.message);n.data=t.data.data,this.emitReserved("connect_error",n);break}}onevent(t){const e=t.data||[];t.id!=null&&e.push(this.ack(t.id)),this.connected?this.emitEvent(e):this.receiveBuffer.push(Object.freeze(e))}emitEvent(t){if(this._anyListeners&&this._anyListeners.length){const e=this._anyListeners.slice();for(const n of e)n.apply(this,t)}super.emit.apply(this,t),this._pid&&t.length&&typeof t[t.length-1]=="string"&&(this._lastOffset=t[t.length-1])}ack(t){const e=this;let n=!1;return function(...i){n||(n=!0,e.packet({type:m.ACK,id:t,data:i}))}}onack(t){const e=this.acks[t.id];typeof e=="function"&&(delete this.acks[t.id],e.withError&&t.data.unshift(null),e.apply(this,t.data))}onconnect(t,e){this.id=t,this.recovered=e&&this._pid===e,this._pid=e,this.connected=!0,this.emitBuffered(),this.emitReserved("connect"),this._drainQueue(!0)}emitBuffered(){this.receiveBuffer.forEach(t=>this.emitEvent(t)),this.receiveBuffer=[],this.sendBuffer.forEach(t=>{this.notifyOutgoingListeners(t),this.packet(t)}),this.sendBuffer=[]}ondisconnect(){this.destroy(),this.onclose("io server disconnect")}destroy(){this.subs&&(this.subs.forEach(t=>t()),this.subs=void 0),this.io._destroy(this)}disconnect(){return this.connected&&this.packet({type:m.DISCONNECT}),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}close(){return this.disconnect()}compress(t){return this.flags.compress=t,this}get volatile(){return this.flags.volatile=!0,this}timeout(t){return this.flags.timeout=t,this}onAny(t){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(t),this}prependAny(t){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(t),this}offAny(t){if(!this._anyListeners)return this;if(t){const e=this._anyListeners;for(let n=0;n<e.length;n++)if(t===e[n])return e.splice(n,1),this}else this._anyListeners=[];return this}listenersAny(){return this._anyListeners||[]}onAnyOutgoing(t){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.push(t),this}prependAnyOutgoing(t){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.unshift(t),this}offAnyOutgoing(t){if(!this._anyOutgoingListeners)return this;if(t){const e=this._anyOutgoingListeners;for(let n=0;n<e.length;n++)if(t===e[n])return e.splice(n,1),this}else this._anyOutgoingListeners=[];return this}listenersAnyOutgoing(){return this._anyOutgoingListeners||[]}notifyOutgoingListeners(t){if(this._anyOutgoingListeners&&this._anyOutgoingListeners.length){const e=this._anyOutgoingListeners.slice();for(const n of e)n.apply(this,t.data)}}}function ot(s){s=s||{},this.ms=s.min||100,this.max=s.max||1e4,this.factor=s.factor||2,this.jitter=s.jitter>0&&s.jitter<=1?s.jitter:0,this.attempts=0}ot.prototype.duration=function(){var s=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var t=Math.random(),e=Math.floor(t*this.jitter*s);s=Math.floor(t*10)&1?s+e:s-e}return Math.min(s,this.max)|0};ot.prototype.reset=function(){this.attempts=0};ot.prototype.setMin=function(s){this.ms=s};ot.prototype.setMax=function(s){this.max=s};ot.prototype.setJitter=function(s){this.jitter=s};class ue extends A{constructor(t,e){var n;super(),this.nsps={},this.subs=[],t&&typeof t=="object"&&(e=t,t=void 0),e=e||{},e.path=e.path||"/socket.io",this.opts=e,Yn(this,e),this.reconnection(e.reconnection!==!1),this.reconnectionAttempts(e.reconnectionAttempts||1/0),this.reconnectionDelay(e.reconnectionDelay||1e3),this.reconnectionDelayMax(e.reconnectionDelayMax||5e3),this.randomizationFactor((n=e.randomizationFactor)!==null&&n!==void 0?n:.5),this.backoff=new ot({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(e.timeout==null?2e4:e.timeout),this._readyState="closed",this.uri=t;const i=e.parser||Cs;this.encoder=new i.Encoder,this.decoder=new i.Decoder,this._autoConnect=e.autoConnect!==!1,this._autoConnect&&this.open()}reconnection(t){return arguments.length?(this._reconnection=!!t,t||(this.skipReconnect=!0),this):this._reconnection}reconnectionAttempts(t){return t===void 0?this._reconnectionAttempts:(this._reconnectionAttempts=t,this)}reconnectionDelay(t){var e;return t===void 0?this._reconnectionDelay:(this._reconnectionDelay=t,(e=this.backoff)===null||e===void 0||e.setMin(t),this)}randomizationFactor(t){var e;return t===void 0?this._randomizationFactor:(this._randomizationFactor=t,(e=this.backoff)===null||e===void 0||e.setJitter(t),this)}reconnectionDelayMax(t){var e;return t===void 0?this._reconnectionDelayMax:(this._reconnectionDelayMax=t,(e=this.backoff)===null||e===void 0||e.setMax(t),this)}timeout(t){return arguments.length?(this._timeout=t,this):this._timeout}maybeReconnectOnOpen(){!this._reconnecting&&this._reconnection&&this.backoff.attempts===0&&this.reconnect()}open(t){if(~this._readyState.indexOf("open"))return this;this.engine=new Jn(this.uri,this.opts);const e=this.engine,n=this;this._readyState="opening",this.skipReconnect=!1;const i=x(e,"open",function(){n.onopen(),t&&t()}),r=c=>{this.cleanup(),this._readyState="closed",this.emitReserved("error",c),t?t(c):this.maybeReconnectOnOpen()},o=x(e,"error",r);if(this._timeout!==!1){const c=this._timeout,l=this.setTimeoutFn(()=>{i(),r(new Error("timeout")),e.close()},c);this.opts.autoUnref&&l.unref(),this.subs.push(()=>{this.clearTimeoutFn(l)})}return this.subs.push(i),this.subs.push(o),this}connect(t){return this.open(t)}onopen(){this.cleanup(),this._readyState="open",this.emitReserved("open");const t=this.engine;this.subs.push(x(t,"ping",this.onping.bind(this)),x(t,"data",this.ondata.bind(this)),x(t,"error",this.onerror.bind(this)),x(t,"close",this.onclose.bind(this)),x(this.decoder,"decoded",this.ondecoded.bind(this)))}onping(){this.emitReserved("ping")}ondata(t){try{this.decoder.add(t)}catch(e){this.onclose("parse error",e)}}ondecoded(t){Kn(()=>{this.emitReserved("packet",t)},this.setTimeoutFn)}onerror(t){this.emitReserved("error",t)}socket(t,e){let n=this.nsps[t];return n?this._autoConnect&&!n.active&&n.connect():(n=new cn(this,t,e),this.nsps[t]=n),n}_destroy(t){const e=Object.keys(this.nsps);for(const n of e)if(this.nsps[n].active)return;this._close()}_packet(t){const e=this.encoder.encode(t);for(let n=0;n<e.length;n++)this.engine.write(e[n],t.options)}cleanup(){this.subs.forEach(t=>t()),this.subs.length=0,this.decoder.destroy()}_close(){this.skipReconnect=!0,this._reconnecting=!1,this.onclose("forced close")}disconnect(){return this._close()}onclose(t,e){var n;this.cleanup(),(n=this.engine)===null||n===void 0||n.close(),this.backoff.reset(),this._readyState="closed",this.emitReserved("close",t,e),this._reconnection&&!this.skipReconnect&&this.reconnect()}reconnect(){if(this._reconnecting||this.skipReconnect)return this;const t=this;if(this.backoff.attempts>=this._reconnectionAttempts)this.backoff.reset(),this.emitReserved("reconnect_failed"),this._reconnecting=!1;else{const e=this.backoff.duration();this._reconnecting=!0;const n=this.setTimeoutFn(()=>{t.skipReconnect||(this.emitReserved("reconnect_attempt",t.backoff.attempts),!t.skipReconnect&&t.open(i=>{i?(t._reconnecting=!1,t.reconnect(),this.emitReserved("reconnect_error",i)):t.onreconnect()}))},e);this.opts.autoUnref&&n.unref(),this.subs.push(()=>{this.clearTimeoutFn(n)})}}onreconnect(){const t=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved("reconnect",t)}}const at={};function te(s,t){typeof s=="object"&&(t=s,s=void 0),t=t||{};const e=fs(s,t.path||"/socket.io"),n=e.source,i=e.id,r=e.path,o=at[i]&&r in at[i].nsps,c=t.forceNew||t["force new connection"]||t.multiplex===!1||o;let l;return c?l=new ue(n,t):(at[i]||(at[i]=new ue(n,t)),l=at[i]),e.query&&!t.query&&(t.query=e.queryKey),l.socket(e.path,t)}Object.assign(te,{Manager:ue,Socket:cn,io:te,connect:te});class _e{constructor(t,e){this.clock=t,this.len=e}}class ct{constructor(){this.clients=new Map}}const tt=(s,t,e)=>t.clients.forEach((n,i)=>{const r=s.doc.store.clients.get(i);for(let o=0;o<n.length;o++){const c=n[o];wn(s,r,c.clock,c.len,e)}}),As=(s,t)=>{let e=0,n=s.length-1;for(;e<=n;){const i=oe((e+n)/2),r=s[i],o=r.clock;if(o<=t){if(t<o+r.len)return i;e=i+1}else n=i-1}return null},mt=(s,t)=>{const e=s.clients.get(t.client);return e!==void 0&&As(e,t.clock)!==null},ye=s=>{s.clients.forEach(t=>{t.sort((i,r)=>i.clock-r.clock);let e,n;for(e=1,n=1;e<t.length;e++){const i=t[n-1],r=t[e];i.clock+i.len>=r.clock?i.len=wt(i.len,r.clock+r.len-i.clock):(n<e&&(t[n]=r),n++)}t.length=n})},de=s=>{const t=new ct;for(let e=0;e<s.length;e++)s[e].clients.forEach((n,i)=>{if(!t.clients.has(i)){const r=n.slice();for(let o=e+1;o<s.length;o++)os(r,s[o].clients.get(i)||[]);t.clients.set(i,r)}});return ye(t),t},dt=(s,t,e,n)=>{j(s.clients,t,()=>[]).push(new _e(e,n))},Is=()=>new ct,Os=s=>{const t=Is();return s.clients.forEach((e,n)=>{const i=[];for(let r=0;r<e.length;r++){const o=e[r];if(o.deleted){const c=o.id.clock;let l=o.length;if(r+1<e.length)for(let a=e[r+1];r+1<e.length&&a.deleted;a=e[++r+1])l+=a.length;i.push(new _e(c,l))}}i.length>0&&t.clients.set(n,i)}),t},lt=(s,t)=>{y(s.restEncoder,t.clients.size),P(t.clients.entries()).sort((e,n)=>n[0]-e[0]).forEach(([e,n])=>{s.resetDsCurVal(),y(s.restEncoder,e);const i=n.length;y(s.restEncoder,i);for(let r=0;r<i;r++){const o=n[r];s.writeDsClock(o.clock),s.writeDsLen(o.len)}})},be=s=>{const t=new ct,e=k(s.restDecoder);for(let n=0;n<e;n++){s.resetDsCurVal();const i=k(s.restDecoder),r=k(s.restDecoder);if(r>0){const o=j(t.clients,i,()=>[]);for(let c=0;c<r;c++)o.push(new _e(s.readDsClock(),s.readDsLen()))}}return t},Je=(s,t,e)=>{const n=new ct,i=k(s.restDecoder);for(let r=0;r<i;r++){s.resetDsCurVal();const o=k(s.restDecoder),c=k(s.restDecoder),l=e.clients.get(o)||[],a=C(e,o);for(let h=0;h<c;h++){const u=s.readDsClock(),d=u+s.readDsLen();if(u<a){a<d&&dt(n,o,a,d-a);let f=V(l,u),g=l[f];for(!g.deleted&&g.id.clock<u&&(l.splice(f+1,0,Vt(t,g,u-g.id.clock)),f++);f<l.length&&(g=l[f++],g.id.clock<d);)g.deleted||(d<g.id.clock+g.length&&l.splice(f,0,Vt(t,g,d-g.id.clock)),g.delete(t))}else dt(n,o,u,d-u)}}if(n.clients.size>0){const r=new z;return y(r.restEncoder,0),lt(r,n),r.toUint8Array()}return null},ln=qn;class kt extends en{constructor({guid:t=$n(),collectionid:e=null,gc:n=!0,gcFilter:i=()=>!0,meta:r=null,autoLoad:o=!1,shouldLoad:c=!0}={}){super(),this.gc=n,this.gcFilter=i,this.clientID=ln(),this.guid=t,this.collectionid=e,this.share=new Map,this.store=new gn,this._transaction=null,this._transactionCleanups=[],this.subdocs=new Set,this._item=null,this.shouldLoad=c,this.autoLoad=o,this.meta=r,this.isLoaded=!1,this.isSynced=!1,this.isDestroyed=!1,this.whenLoaded=xe(a=>{this.on("load",()=>{this.isLoaded=!0,a(this)})});const l=()=>xe(a=>{const h=u=>{(u===void 0||u===!0)&&(this.off("sync",h),a())};this.on("sync",h)});this.on("sync",a=>{a===!1&&this.isSynced&&(this.whenSynced=l()),this.isSynced=a===void 0||a===!0,this.isSynced&&!this.isLoaded&&this.emit("load",[this])}),this.whenSynced=l()}load(){const t=this._item;t!==null&&!this.shouldLoad&&_(t.parent.doc,e=>{e.subdocsLoaded.add(this)},null,!0),this.shouldLoad=!0}getSubdocs(){return this.subdocs}getSubdocGuids(){return new Set(P(this.subdocs).map(t=>t.guid))}transact(t,e=null){return _(this,t,e)}get(t,e=I){const n=j(this.share,t,()=>{const r=new e;return r._integrate(this,null),r}),i=n.constructor;if(e!==I&&i!==e)if(i===I){const r=new e;r._map=n._map,n._map.forEach(o=>{for(;o!==null;o=o.left)o.parent=r}),r._start=n._start;for(let o=r._start;o!==null;o=o.right)o.parent=r;return r._length=n._length,this.share.set(t,r),r._integrate(this,null),r}else throw new Error(`Type with the name ${t} has already been defined with a different constructor`);return n}getArray(t=""){return this.get(t,Z)}getText(t=""){return this.get(t,st)}getMap(t=""){return this.get(t,nt)}getXmlElement(t=""){return this.get(t,it)}getXmlFragment(t=""){return this.get(t,q)}toJSON(){const t={};return this.share.forEach((e,n)=>{t[n]=e.toJSON()}),t}destroy(){this.isDestroyed=!0,P(this.subdocs).forEach(e=>e.destroy());const t=this._item;if(t!==null){this._item=null;const e=t.content;e.doc=new kt({guid:this.guid,...e.opts,shouldLoad:!1}),e.doc._item=t,_(t.parent.doc,n=>{const i=e.doc;t.deleted||n.subdocsAdded.add(i),n.subdocsRemoved.add(this)},null,!0)}this.emit("destroyed",[!0]),this.emit("destroy",[this]),super.destroy()}}class hn{constructor(t){this.restDecoder=t}resetDsCurVal(){}readDsClock(){return k(this.restDecoder)}readDsLen(){return k(this.restDecoder)}}class an extends hn{readLeftID(){return w(k(this.restDecoder),k(this.restDecoder))}readRightID(){return w(k(this.restDecoder),k(this.restDecoder))}readClient(){return k(this.restDecoder)}readInfo(){return ce(this.restDecoder)}readString(){return Xt(this.restDecoder)}readParentInfo(){return k(this.restDecoder)===1}readTypeRef(){return k(this.restDecoder)}readLen(){return k(this.restDecoder)}readAny(){return le(this.restDecoder)}readBuf(){return cs(v(this.restDecoder))}readJSON(){return JSON.parse(Xt(this.restDecoder))}readKey(){return Xt(this.restDecoder)}}class Ns{constructor(t){this.dsCurrVal=0,this.restDecoder=t}resetDsCurVal(){this.dsCurrVal=0}readDsClock(){return this.dsCurrVal+=k(this.restDecoder),this.dsCurrVal}readDsLen(){const t=k(this.restDecoder)+1;return this.dsCurrVal+=t,t}}class et extends Ns{constructor(t){super(t),this.keys=[],k(t),this.keyClockDecoder=new Zt(v(t)),this.clientDecoder=new Pt(v(t)),this.leftClockDecoder=new Zt(v(t)),this.rightClockDecoder=new Zt(v(t)),this.infoDecoder=new Ue(v(t),ce),this.stringDecoder=new ls(v(t)),this.parentInfoDecoder=new Ue(v(t),ce),this.typeRefDecoder=new Pt(v(t)),this.lenDecoder=new Pt(v(t))}readLeftID(){return new X(this.clientDecoder.read(),this.leftClockDecoder.read())}readRightID(){return new X(this.clientDecoder.read(),this.rightClockDecoder.read())}readClient(){return this.clientDecoder.read()}readInfo(){return this.infoDecoder.read()}readString(){return this.stringDecoder.read()}readParentInfo(){return this.parentInfoDecoder.read()===1}readTypeRef(){return this.typeRefDecoder.read()}readLen(){return this.lenDecoder.read()}readAny(){return le(this.restDecoder)}readBuf(){return v(this.restDecoder)}readJSON(){return le(this.restDecoder)}readKey(){const t=this.keyClockDecoder.read();if(t<this.keys.length)return this.keys[t];{const e=this.stringDecoder.read();return this.keys.push(e),e}}}class Ls{constructor(){this.restEncoder=Ft()}toUint8Array(){return K(this.restEncoder)}resetDsCurVal(){}writeDsClock(t){y(this.restEncoder,t)}writeDsLen(t){y(this.restEncoder,t)}}class _t extends Ls{writeLeftID(t){y(this.restEncoder,t.client),y(this.restEncoder,t.clock)}writeRightID(t){y(this.restEncoder,t.client),y(this.restEncoder,t.clock)}writeClient(t){y(this.restEncoder,t)}writeInfo(t){ie(this.restEncoder,t)}writeString(t){Qt(this.restEncoder,t)}writeParentInfo(t){y(this.restEncoder,t?1:0)}writeTypeRef(t){y(this.restEncoder,t)}writeLen(t){y(this.restEncoder,t)}writeAny(t){re(this.restEncoder,t)}writeBuf(t){R(this.restEncoder,t)}writeJSON(t){Qt(this.restEncoder,JSON.stringify(t))}writeKey(t){Qt(this.restEncoder,t)}}class Ts{constructor(){this.restEncoder=Ft(),this.dsCurrVal=0}toUint8Array(){return K(this.restEncoder)}resetDsCurVal(){this.dsCurrVal=0}writeDsClock(t){const e=t-this.dsCurrVal;this.dsCurrVal=t,y(this.restEncoder,e)}writeDsLen(t){t===0&&B(),y(this.restEncoder,t-1),this.dsCurrVal+=t}}class z extends Ts{constructor(){super(),this.keyMap=new Map,this.keyClock=0,this.keyClockEncoder=new Gt,this.clientEncoder=new jt,this.leftClockEncoder=new Gt,this.rightClockEncoder=new Gt,this.infoEncoder=new Ve(ie),this.stringEncoder=new Zn,this.parentInfoEncoder=new Ve(ie),this.typeRefEncoder=new jt,this.lenEncoder=new jt}toUint8Array(){const t=Ft();return y(t,0),R(t,this.keyClockEncoder.toUint8Array()),R(t,this.clientEncoder.toUint8Array()),R(t,this.leftClockEncoder.toUint8Array()),R(t,this.rightClockEncoder.toUint8Array()),R(t,K(this.infoEncoder)),R(t,this.stringEncoder.toUint8Array()),R(t,K(this.parentInfoEncoder)),R(t,this.typeRefEncoder.toUint8Array()),R(t,this.lenEncoder.toUint8Array()),rn(t,K(this.restEncoder)),K(t)}writeLeftID(t){this.clientEncoder.write(t.client),this.leftClockEncoder.write(t.clock)}writeRightID(t){this.clientEncoder.write(t.client),this.rightClockEncoder.write(t.clock)}writeClient(t){this.clientEncoder.write(t)}writeInfo(t){this.infoEncoder.write(t)}writeString(t){this.stringEncoder.write(t)}writeParentInfo(t){this.parentInfoEncoder.write(t?1:0)}writeTypeRef(t){this.typeRefEncoder.write(t)}writeLen(t){this.lenEncoder.write(t)}writeAny(t){re(this.restEncoder,t)}writeBuf(t){R(this.restEncoder,t)}writeJSON(t){re(this.restEncoder,t)}writeKey(t){const e=this.keyMap.get(t);e===void 0?(this.keyClockEncoder.write(this.keyClock++),this.stringEncoder.write(t)):this.keyClockEncoder.write(e)}}const Rs=(s,t,e,n)=>{n=wt(n,t[0].id.clock);const i=V(t,n);y(s.restEncoder,t.length-i),s.writeClient(e),y(s.restEncoder,n);const r=t[i];r.write(s,n-r.id.clock);for(let o=i+1;o<t.length;o++)t[o].write(s,0)},Se=(s,t,e)=>{const n=new Map;e.forEach((i,r)=>{C(t,r)>i&&n.set(r,i)}),Ee(t).forEach((i,r)=>{e.has(r)||n.set(r,0)}),y(s.restEncoder,n.size),P(n.entries()).sort((i,r)=>r[0]-i[0]).forEach(([i,r])=>{Rs(s,t.clients.get(i),i,r)})},vs=(s,t)=>{const e=we(),n=k(s.restDecoder);for(let i=0;i<n;i++){const r=k(s.restDecoder),o=new Array(r),c=s.readClient();let l=k(s.restDecoder);e.set(c,{i:0,refs:o});for(let a=0;a<r;a++){const h=s.readInfo();switch(Ut&h){case 0:{const u=s.readLen();o[a]=new L(w(c,l),u),l+=u;break}case 10:{const u=k(s.restDecoder);o[a]=new T(w(c,l),u),l+=u;break}default:{const u=(h&(H|$))===0,d=new b(w(c,l),null,(h&$)===$?s.readLeftID():null,null,(h&H)===H?s.readRightID():null,u?s.readParentInfo()?t.get(s.readString()):s.readLeftID():null,u&&(h&ut)===ut?s.readString():null,Bn(s,h));o[a]=d,l+=d.length}}}}return e},xs=(s,t,e)=>{const n=[];let i=P(e.keys()).sort((f,g)=>f-g);if(i.length===0)return null;const r=()=>{if(i.length===0)return null;let f=e.get(i[i.length-1]);for(;f.refs.length===f.i;)if(i.pop(),i.length>0)f=e.get(i[i.length-1]);else return null;return f};let o=r();if(o===null)return null;const c=new gn,l=new Map,a=(f,g)=>{const p=l.get(f);(p==null||p>g)&&l.set(f,g)};let h=o.refs[o.i++];const u=new Map,d=()=>{for(const f of n){const g=f.id.client,p=e.get(g);p?(p.i--,c.clients.set(g,p.refs.slice(p.i)),e.delete(g),p.i=0,p.refs=[]):c.clients.set(g,[f]),i=i.filter(S=>S!==g)}n.length=0};for(;;){if(h.constructor!==T){const g=j(u,h.id.client,()=>C(t,h.id.client))-h.id.clock;if(g<0)n.push(h),a(h.id.client,h.id.clock-1),d();else{const p=h.getMissing(s,t);if(p!==null){n.push(h);const S=e.get(p)||{refs:[],i:0};if(S.refs.length===S.i)a(p,C(t,p)),d();else{h=S.refs[S.i++];continue}}else(g===0||g<h.length)&&(h.integrate(s,g),u.set(h.id.client,h.id.clock+h.length))}}if(n.length>0)h=n.pop();else if(o!==null&&o.i<o.refs.length)h=o.refs[o.i++];else{if(o=r(),o===null)break;h=o.refs[o.i++]}}if(c.clients.size>0){const f=new z;return Se(f,c,new Map),y(f.restEncoder,0),{missing:l,update:f.toUint8Array()}}return null},Ms=(s,t)=>Se(s,t.doc.store,t.beforeState),Bs=(s,t,e,n=new et(s))=>_(t,i=>{i.local=!1;let r=!1;const o=i.doc,c=o.store,l=vs(n,o),a=xs(i,c,l),h=c.pendingStructs;if(h){for(const[d,f]of h.missing)if(f<C(c,d)){r=!0;break}if(a){for(const[d,f]of a.missing){const g=h.missing.get(d);(g==null||g>f)&&h.missing.set(d,f)}h.update=Tt([h.update,a.update])}}else c.pendingStructs=a;const u=Je(n,i,c);if(c.pendingDs){const d=new et(rt(c.pendingDs));k(d.restDecoder);const f=Je(d,i,c);u&&f?c.pendingDs=Tt([u,f]):c.pendingDs=u||f}else c.pendingDs=u;if(r){const d=c.pendingStructs.update;c.pendingStructs=null,un(i.doc,d)}},e,!1),un=(s,t,e,n=et)=>{const i=rt(t);Bs(i,s,e,new n(i))},Hi=(s,t,e)=>un(s,t,e,an),Vs=(s,t,e=new Map)=>{Se(s,t.store,e),lt(s,Os(t.store))},Us=(s,t=new Uint8Array([0]),e=new z)=>{const n=dn(t);Vs(e,s,n);const i=[e.toUint8Array()];if(s.store.pendingDs&&i.push(s.store.pendingDs),s.store.pendingStructs&&i.push(Xs(s.store.pendingStructs.update,t)),i.length>1){if(e.constructor===_t)return Ws(i.map((r,o)=>o===0?r:Ps(r)));if(e.constructor===z)return Tt(i)}return i[0]},zi=(s,t)=>Us(s,t,new _t),Fs=s=>{const t=new Map,e=k(s.restDecoder);for(let n=0;n<e;n++){const i=k(s.restDecoder),r=k(s.restDecoder);t.set(i,r)}return t},dn=s=>Fs(new hn(rt(s)));class Ys{constructor(){this.l=[]}}const Ke=()=>new Ys,$e=(s,t)=>s.l.push(t),He=(s,t)=>{const e=s.l,n=e.length;s.l=e.filter(i=>t!==i),n===s.l.length&&console.error("[yjs] Tried to remove event handler that doesn't exist.")},fn=(s,t,e)=>nn(s.l,[t,e]);class X{constructor(t,e){this.client=t,this.clock=e}}const St=(s,t)=>s===t||s!==null&&t!==null&&s.client===t.client&&s.clock===t.clock,w=(s,t)=>new X(s,t),Js=s=>{for(const[t,e]of s.doc.share.entries())if(e===s)return t;throw B()},Lt=(s,t)=>{for(;t!==null;){if(t.parent===s)return!0;t=t.parent._item}return!1},Q=(s,t)=>t===void 0?!s.deleted:t.sv.has(s.id.client)&&(t.sv.get(s.id.client)||0)>s.id.clock&&!mt(t.ds,s.id),fe=(s,t)=>{const e=j(s.meta,fe,Nt),n=s.doc.store;e.has(t)||(t.sv.forEach((i,r)=>{i<C(n,r)&&N(s,w(r,i))}),tt(s,t.ds,i=>{}),e.add(t))};class gn{constructor(){this.clients=new Map,this.pendingStructs=null,this.pendingDs=null}}const Ee=s=>{const t=new Map;return s.clients.forEach((e,n)=>{const i=e[e.length-1];t.set(n,i.id.clock+i.length)}),t},C=(s,t)=>{const e=s.clients.get(t);if(e===void 0)return 0;const n=e[e.length-1];return n.id.clock+n.length},pn=(s,t)=>{let e=s.clients.get(t.id.client);if(e===void 0)e=[],s.clients.set(t.id.client,e);else{const n=e[e.length-1];if(n.id.clock+n.length!==t.id.clock)throw B()}e.push(t)},V=(s,t)=>{let e=0,n=s.length-1,i=s[n],r=i.id.clock;if(r===t)return n;let o=oe(t/(r+i.length-1)*n);for(;e<=n;){if(i=s[o],r=i.id.clock,r<=t){if(t<r+i.length)return o;e=o+1}else n=o-1;o=oe((e+n)/2)}throw B()},Ks=(s,t)=>{const e=s.clients.get(t.client);return e[V(e,t.clock)]},At=Ks,ge=(s,t,e)=>{const n=V(t,e),i=t[n];return i.id.clock<e&&i instanceof b?(t.splice(n+1,0,Vt(s,i,e-i.id.clock)),n+1):n},N=(s,t)=>{const e=s.doc.store.clients.get(t.client);return e[ge(s,e,t.clock)]},ze=(s,t,e)=>{const n=t.clients.get(e.client),i=V(n,e.clock),r=n[i];return e.clock!==r.id.clock+r.length-1&&r.constructor!==L&&n.splice(i+1,0,Vt(s,r,e.clock-r.id.clock+1)),r},$s=(s,t,e)=>{const n=s.clients.get(t.id.client);n[V(n,t.id.clock)]=e},wn=(s,t,e,n,i)=>{if(n===0)return;const r=e+n;let o=ge(s,t,e),c;do c=t[o++],r<c.id.clock+c.length&&ge(s,t,r),i(c);while(o<t.length&&t[o].id.clock<r)};class Hs{constructor(t,e,n){this.doc=t,this.deleteSet=new ct,this.beforeState=Ee(t.store),this.afterState=new Map,this.changed=new Map,this.changedParentTypes=new Map,this._mergeStructs=[],this.origin=e,this.meta=new Map,this.local=n,this.subdocsAdded=new Set,this.subdocsRemoved=new Set,this.subdocsLoaded=new Set,this._needFormattingCleanup=!1}}const qe=(s,t)=>t.deleteSet.clients.size===0&&!Pn(t.afterState,(e,n)=>t.beforeState.get(n)!==e)?!1:(ye(t.deleteSet),Ms(s,t),lt(s,t.deleteSet),!0),Ge=(s,t,e)=>{const n=t._item;(n===null||n.id.clock<(s.beforeState.get(n.id.client)||0)&&!n.deleted)&&j(s.changed,t,Nt).add(e)},It=(s,t)=>{let e=s[t],n=s[t-1],i=t;for(;i>0;e=n,n=s[--i-1]){if(n.deleted===e.deleted&&n.constructor===e.constructor&&n.mergeWith(e)){e instanceof b&&e.parentSub!==null&&e.parent._map.get(e.parentSub)===e&&e.parent._map.set(e.parentSub,n);continue}break}const r=t-i;return r&&s.splice(t+1-r,r),r},zs=(s,t,e)=>{for(const[n,i]of s.clients.entries()){const r=t.clients.get(n);for(let o=i.length-1;o>=0;o--){const c=i[o],l=c.clock+c.len;for(let a=V(r,c.clock),h=r[a];a<r.length&&h.id.clock<l;h=r[++a]){const u=r[a];if(c.clock+c.len<=u.id.clock)break;u instanceof b&&u.deleted&&!u.keep&&e(u)&&u.gc(t,!1)}}}},qs=(s,t)=>{s.clients.forEach((e,n)=>{const i=t.clients.get(n);for(let r=e.length-1;r>=0;r--){const o=e[r],c=ts(i.length-1,1+V(i,o.clock+o.len-1));for(let l=c,a=i[l];l>0&&a.id.clock>=o.clock;a=i[l])l-=1+It(i,l)}})},mn=(s,t)=>{if(t<s.length){const e=s[t],n=e.doc,i=n.store,r=e.deleteSet,o=e._mergeStructs;try{ye(r),e.afterState=Ee(e.doc.store),n.emit("beforeObserverCalls",[e,n]);const c=[];e.changed.forEach((l,a)=>c.push(()=>{(a._item===null||!a._item.deleted)&&a._callObserver(e,l)})),c.push(()=>{e.changedParentTypes.forEach((l,a)=>{a._dEH.l.length>0&&(a._item===null||!a._item.deleted)&&(l=l.filter(h=>h.target._item===null||!h.target._item.deleted),l.forEach(h=>{h.currentTarget=a,h._path=null}),l.sort((h,u)=>h.path.length-u.path.length),fn(a._dEH,l,e))})}),c.push(()=>n.emit("afterTransaction",[e,n])),nn(c,[]),e._needFormattingCleanup&&fi(e)}finally{n.gc&&zs(r,i,n.gcFilter),qs(r,i),e.afterState.forEach((h,u)=>{const d=e.beforeState.get(u)||0;if(d!==h){const f=i.clients.get(u),g=wt(V(f,d),1);for(let p=f.length-1;p>=g;)p-=1+It(f,p)}});for(let h=o.length-1;h>=0;h--){const{client:u,clock:d}=o[h].id,f=i.clients.get(u),g=V(f,d);g+1<f.length&&It(f,g+1)>1||g>0&&It(f,g)}if(!e.local&&e.afterState.get(n.clientID)!==e.beforeState.get(n.clientID)&&(Gn(is,ss,"[yjs] ",ns,es,"Changed the client-id because another client seems to be using it."),n.clientID=ln()),n.emit("afterTransactionCleanup",[e,n]),n._observers.has("update")){const h=new _t;qe(h,e)&&n.emit("update",[h.toUint8Array(),e.origin,n,e])}if(n._observers.has("updateV2")){const h=new z;qe(h,e)&&n.emit("updateV2",[h.toUint8Array(),e.origin,n,e])}const{subdocsAdded:c,subdocsLoaded:l,subdocsRemoved:a}=e;(c.size>0||a.size>0||l.size>0)&&(c.forEach(h=>{h.clientID=n.clientID,h.collectionid==null&&(h.collectionid=n.collectionid),n.subdocs.add(h)}),a.forEach(h=>n.subdocs.delete(h)),n.emit("subdocs",[{loaded:l,added:c,removed:a},n,e]),a.forEach(h=>h.destroy())),s.length<=t+1?(n._transactionCleanups=[],n.emit("afterAllTransactions",[n,s])):mn(s,t+1)}}},_=(s,t,e=null,n=!0)=>{const i=s._transactionCleanups;let r=!1,o=null;s._transaction===null&&(r=!0,s._transaction=new Hs(s,e,n),i.push(s._transaction),i.length===1&&s.emit("beforeAllTransactions",[s]),s.emit("beforeTransaction",[s._transaction,s]));try{o=t(s._transaction)}finally{if(r){const c=s._transaction===i[0];s._transaction=null,c&&mn(i,0)}}return o};class Gs{constructor(t,e){this.insertions=e,this.deletions=t,this.meta=new Map}}const je=(s,t,e)=>{tt(s,e.deletions,n=>{n instanceof b&&t.scope.some(i=>Lt(i,n))&&Te(n,!1)})},We=(s,t,e)=>{let n=null;const i=s.doc,r=s.scope;_(i,c=>{for(;t.length>0&&s.currStackItem===null;){const l=i.store,a=t.pop(),h=new Set,u=[];let d=!1;tt(c,a.insertions,f=>{if(f instanceof b){if(f.redone!==null){let{item:g,diff:p}=Yi(l,f.id);p>0&&(g=N(c,w(g.id.client,g.id.clock+p))),f=g}!f.deleted&&r.some(g=>Lt(g,f))&&u.push(f)}}),tt(c,a.deletions,f=>{f instanceof b&&r.some(g=>Lt(g,f))&&!mt(a.insertions,f.id)&&h.add(f)}),h.forEach(f=>{d=Mn(c,f,h,a.insertions,s.ignoreRemoteMapChanges,s)!==null||d});for(let f=u.length-1;f>=0;f--){const g=u[f];s.deleteFilter(g)&&(g.delete(c),d=!0)}s.currStackItem=d?a:null}c.changed.forEach((l,a)=>{l.has(null)&&a._searchMarker&&(a._searchMarker.length=0)}),n=c},s);const o=s.currStackItem;if(o!=null){const c=n.changedParentTypes;s.emit("stack-item-popped",[{stackItem:o,type:e,changedParentTypes:c,origin:s},s]),s.currStackItem=null}return o};class qi extends en{constructor(t,{captureTimeout:e=500,captureTransaction:n=l=>!0,deleteFilter:i=()=>!0,trackedOrigins:r=new Set([null]),ignoreRemoteMapChanges:o=!1,doc:c=Fe(t)?t[0].doc:t.doc}={}){super(),this.scope=[],this.doc=c,this.addToScope(t),this.deleteFilter=i,r.add(this),this.trackedOrigins=r,this.captureTransaction=n,this.undoStack=[],this.redoStack=[],this.undoing=!1,this.redoing=!1,this.currStackItem=null,this.lastChange=0,this.ignoreRemoteMapChanges=o,this.captureTimeout=e,this.afterTransactionHandler=l=>{if(!this.captureTransaction(l)||!this.scope.some(S=>l.changedParentTypes.has(S))||!this.trackedOrigins.has(l.origin)&&(!l.origin||!this.trackedOrigins.has(l.origin.constructor)))return;const a=this.undoing,h=this.redoing,u=a?this.redoStack:this.undoStack;a?this.stopCapturing():h||this.clear(!1,!0);const d=new ct;l.afterState.forEach((S,E)=>{const Re=l.beforeState.get(E)||0,ve=S-Re;ve>0&&dt(d,E,Re,ve)});const f=as();let g=!1;if(this.lastChange>0&&f-this.lastChange<this.captureTimeout&&u.length>0&&!a&&!h){const S=u[u.length-1];S.deletions=de([S.deletions,l.deleteSet]),S.insertions=de([S.insertions,d])}else u.push(new Gs(l.deleteSet,d)),g=!0;!a&&!h&&(this.lastChange=f),tt(l,l.deleteSet,S=>{S instanceof b&&this.scope.some(E=>Lt(E,S))&&Te(S,!0)});const p=[{stackItem:u[u.length-1],origin:l.origin,type:a?"redo":"undo",changedParentTypes:l.changedParentTypes},this];g?this.emit("stack-item-added",p):this.emit("stack-item-updated",p)},this.doc.on("afterTransaction",this.afterTransactionHandler),this.doc.on("destroy",()=>{this.destroy()})}addToScope(t){t=Fe(t)?t:[t],t.forEach(e=>{this.scope.every(n=>n!==e)&&(e.doc!==this.doc&&sn("[yjs#509] Not same Y.Doc"),this.scope.push(e))})}addTrackedOrigin(t){this.trackedOrigins.add(t)}removeTrackedOrigin(t){this.trackedOrigins.delete(t)}clear(t=!0,e=!0){(t&&this.canUndo()||e&&this.canRedo())&&this.doc.transact(n=>{t&&(this.undoStack.forEach(i=>je(n,this,i)),this.undoStack=[]),e&&(this.redoStack.forEach(i=>je(n,this,i)),this.redoStack=[]),this.emit("stack-cleared",[{undoStackCleared:t,redoStackCleared:e}])})}stopCapturing(){this.lastChange=0}undo(){this.undoing=!0;let t;try{t=We(this,this.undoStack,"undo")}finally{this.undoing=!1}return t}redo(){this.redoing=!0;let t;try{t=We(this,this.redoStack,"redo")}finally{this.redoing=!1}return t}canUndo(){return this.undoStack.length>0}canRedo(){return this.redoStack.length>0}destroy(){this.trackedOrigins.delete(this),this.doc.off("afterTransaction",this.afterTransactionHandler),super.destroy()}}function*js(s){const t=k(s.restDecoder);for(let e=0;e<t;e++){const n=k(s.restDecoder),i=s.readClient();let r=k(s.restDecoder);for(let o=0;o<n;o++){const c=s.readInfo();if(c===10){const l=k(s.restDecoder);yield new T(w(i,r),l),r+=l}else if(Ut&c){const l=(c&(H|$))===0,a=new b(w(i,r),null,(c&$)===$?s.readLeftID():null,null,(c&H)===H?s.readRightID():null,l?s.readParentInfo()?s.readString():s.readLeftID():null,l&&(c&ut)===ut?s.readString():null,Bn(s,c));yield a,r+=a.length}else{const l=s.readLen();yield new L(w(i,r),l),r+=l}}}}class Ce{constructor(t,e){this.gen=js(t),this.curr=null,this.done=!1,this.filterSkips=e,this.next()}next(){do this.curr=this.gen.next().value||null;while(this.filterSkips&&this.curr!==null&&this.curr.constructor===T);return this.curr}}class De{constructor(t){this.currClient=0,this.startClock=0,this.written=0,this.encoder=t,this.clientStructs=[]}}const Ws=s=>Tt(s,an,_t),Qs=(s,t)=>{if(s.constructor===L){const{client:e,clock:n}=s.id;return new L(w(e,n+t),s.length-t)}else if(s.constructor===T){const{client:e,clock:n}=s.id;return new T(w(e,n+t),s.length-t)}else{const e=s,{client:n,clock:i}=e.id;return new b(w(n,i+t),null,w(n,i+t-1),null,e.rightOrigin,e.parent,e.parentSub,e.content.splice(t))}},Tt=(s,t=et,e=z)=>{if(s.length===1)return s[0];const n=s.map(h=>new t(rt(h)));let i=n.map(h=>new Ce(h,!0)),r=null;const o=new e,c=new De(o);for(;i=i.filter(d=>d.curr!==null),i.sort((d,f)=>{if(d.curr.id.client===f.curr.id.client){const g=d.curr.id.clock-f.curr.id.clock;return g===0?d.curr.constructor===f.curr.constructor?0:d.curr.constructor===T?1:-1:g}else return f.curr.id.client-d.curr.id.client}),i.length!==0;){const h=i[0],u=h.curr.id.client;if(r!==null){let d=h.curr,f=!1;for(;d!==null&&d.id.clock+d.length<=r.struct.id.clock+r.struct.length&&d.id.client>=r.struct.id.client;)d=h.next(),f=!0;if(d===null||d.id.client!==u||f&&d.id.clock>r.struct.id.clock+r.struct.length)continue;if(u!==r.struct.id.client)Y(c,r.struct,r.offset),r={struct:d,offset:0},h.next();else if(r.struct.id.clock+r.struct.length<d.id.clock)if(r.struct.constructor===T)r.struct.length=d.id.clock+d.length-r.struct.id.clock;else{Y(c,r.struct,r.offset);const g=d.id.clock-r.struct.id.clock-r.struct.length;r={struct:new T(w(u,r.struct.id.clock+r.struct.length),g),offset:0}}else{const g=r.struct.id.clock+r.struct.length-d.id.clock;g>0&&(r.struct.constructor===T?r.struct.length-=g:d=Qs(d,g)),r.struct.mergeWith(d)||(Y(c,r.struct,r.offset),r={struct:d,offset:0},h.next())}}else r={struct:h.curr,offset:0},h.next();for(let d=h.curr;d!==null&&d.id.client===u&&d.id.clock===r.struct.id.clock+r.struct.length&&d.constructor!==T;d=h.next())Y(c,r.struct,r.offset),r={struct:d,offset:0}}r!==null&&(Y(c,r.struct,r.offset),r=null),Ae(c);const l=n.map(h=>be(h)),a=de(l);return lt(o,a),o.toUint8Array()},Xs=(s,t,e=et,n=z)=>{const i=dn(t),r=new n,o=new De(r),c=new e(rt(s)),l=new Ce(c,!1);for(;l.curr;){const h=l.curr,u=h.id.client,d=i.get(u)||0;if(l.curr.constructor===T){l.next();continue}if(h.id.clock+h.length>d)for(Y(o,h,wt(d-h.id.clock,0)),l.next();l.curr&&l.curr.id.client===u;)Y(o,l.curr,0),l.next();else for(;l.curr&&l.curr.id.client===u&&l.curr.id.clock+l.curr.length<=d;)l.next()}Ae(o);const a=be(c);return lt(r,a),r.toUint8Array()},kn=s=>{s.written>0&&(s.clientStructs.push({written:s.written,restEncoder:K(s.encoder.restEncoder)}),s.encoder.restEncoder=Ft(),s.written=0)},Y=(s,t,e)=>{s.written>0&&s.currClient!==t.id.client&&kn(s),s.written===0&&(s.currClient=t.id.client,s.encoder.writeClient(t.id.client),y(s.encoder.restEncoder,t.id.clock+e)),t.write(s.encoder,e),s.written++},Ae=s=>{kn(s);const t=s.encoder.restEncoder;y(t,s.clientStructs.length);for(let e=0;e<s.clientStructs.length;e++){const n=s.clientStructs[e];y(t,n.written),rn(t,n.restEncoder)}},Zs=(s,t,e,n)=>{const i=new e(rt(s)),r=new Ce(i,!1),o=new n,c=new De(o);for(let a=r.curr;a!==null;a=r.next())Y(c,t(a),0);Ae(c);const l=be(i);return lt(o,l),o.toUint8Array()},Ps=s=>Zs(s,hs,et,_t),Qe="You must not compute changes after the event-handler fired.";class Yt{constructor(t,e){this.target=t,this.currentTarget=t,this.transaction=e,this._changes=null,this._keys=null,this._delta=null,this._path=null}get path(){return this._path||(this._path=ti(this.currentTarget,this.target))}deletes(t){return mt(this.transaction.deleteSet,t.id)}get keys(){if(this._keys===null){if(this.transaction.doc._transactionCleanups.length===0)throw Ot(Qe);const t=new Map,e=this.target;this.transaction.changed.get(e).forEach(i=>{if(i!==null){const r=e._map.get(i);let o,c;if(this.adds(r)){let l=r.left;for(;l!==null&&this.adds(l);)l=l.left;if(this.deletes(r))if(l!==null&&this.deletes(l))o="delete",c=Ht(l.content.getContent());else return;else l!==null&&this.deletes(l)?(o="update",c=Ht(l.content.getContent())):(o="add",c=void 0)}else if(this.deletes(r))o="delete",c=Ht(r.content.getContent());else return;t.set(i,{action:o,oldValue:c})}}),this._keys=t}return this._keys}get delta(){return this.changes.delta}adds(t){return t.id.clock>=(this.transaction.beforeState.get(t.id.client)||0)}get changes(){let t=this._changes;if(t===null){if(this.transaction.doc._transactionCleanups.length===0)throw Ot(Qe);const e=this.target,n=Nt(),i=Nt(),r=[];if(t={added:n,deleted:i,delta:r,keys:this.keys},this.transaction.changed.get(e).has(null)){let c=null;const l=()=>{c&&r.push(c)};for(let a=e._start;a!==null;a=a.right)a.deleted?this.deletes(a)&&!this.adds(a)&&((c===null||c.delete===void 0)&&(l(),c={delete:0}),c.delete+=a.length,i.add(a)):this.adds(a)?((c===null||c.insert===void 0)&&(l(),c={insert:[]}),c.insert=c.insert.concat(a.content.getContent()),n.add(a)):((c===null||c.retain===void 0)&&(l(),c={retain:0}),c.retain+=a.length);c!==null&&c.retain===void 0&&l()}this._changes=t}return t}}const ti=(s,t)=>{const e=[];for(;t._item!==null&&t!==s;){if(t._item.parentSub!==null)e.unshift(t._item.parentSub);else{let n=0,i=t._item.parent._start;for(;i!==t._item&&i!==null;)!i.deleted&&i.countable&&(n+=i.length),i=i.right;e.unshift(n)}t=t._item.parent}return e},O=()=>{sn("Invalid access: Add Yjs type to a document before reading data.")},_n=80;let Ie=0;class ei{constructor(t,e){t.marker=!0,this.p=t,this.index=e,this.timestamp=Ie++}}const ni=s=>{s.timestamp=Ie++},yn=(s,t,e)=>{s.p.marker=!1,s.p=t,t.marker=!0,s.index=e,s.timestamp=Ie++},si=(s,t,e)=>{if(s.length>=_n){const n=s.reduce((i,r)=>i.timestamp<r.timestamp?i:r);return yn(n,t,e),n}else{const n=new ei(t,e);return s.push(n),n}},Jt=(s,t)=>{if(s._start===null||t===0||s._searchMarker===null)return null;const e=s._searchMarker.length===0?null:s._searchMarker.reduce((r,o)=>Wt(t-r.index)<Wt(t-o.index)?r:o);let n=s._start,i=0;for(e!==null&&(n=e.p,i=e.index,ni(e));n.right!==null&&i<t;){if(!n.deleted&&n.countable){if(t<i+n.length)break;i+=n.length}n=n.right}for(;n.left!==null&&i>t;)n=n.left,!n.deleted&&n.countable&&(i-=n.length);for(;n.left!==null&&n.left.id.client===n.id.client&&n.left.id.clock+n.left.length===n.id.clock;)n=n.left,!n.deleted&&n.countable&&(i-=n.length);return e!==null&&Wt(e.index-i)<n.parent.length/_n?(yn(e,n,i),e):si(s._searchMarker,n,i)},ft=(s,t,e)=>{for(let n=s.length-1;n>=0;n--){const i=s[n];if(e>0){let r=i.p;for(r.marker=!1;r&&(r.deleted||!r.countable);)r=r.left,r&&!r.deleted&&r.countable&&(i.index-=r.length);if(r===null||r.marker===!0){s.splice(n,1);continue}i.p=r,r.marker=!0}(t<i.index||e>0&&t===i.index)&&(i.index=wt(t,i.index+e))}},Kt=(s,t,e)=>{const n=s,i=t.changedParentTypes;for(;j(i,s,()=>[]).push(e),s._item!==null;)s=s._item.parent;fn(n._eH,e,t)};class I{constructor(){this._item=null,this._map=new Map,this._start=null,this.doc=null,this._length=0,this._eH=Ke(),this._dEH=Ke(),this._searchMarker=null}get parent(){return this._item?this._item.parent:null}_integrate(t,e){this.doc=t,this._item=e}_copy(){throw M()}clone(){throw M()}_write(t){}get _first(){let t=this._start;for(;t!==null&&t.deleted;)t=t.right;return t}_callObserver(t,e){!t.local&&this._searchMarker&&(this._searchMarker.length=0)}observe(t){$e(this._eH,t)}observeDeep(t){$e(this._dEH,t)}unobserve(t){He(this._eH,t)}unobserveDeep(t){He(this._dEH,t)}toJSON(){}}const bn=(s,t,e)=>{s.doc??O(),t<0&&(t=s._length+t),e<0&&(e=s._length+e);let n=e-t;const i=[];let r=s._start;for(;r!==null&&n>0;){if(r.countable&&!r.deleted){const o=r.content.getContent();if(o.length<=t)t-=o.length;else{for(let c=t;c<o.length&&n>0;c++)i.push(o[c]),n--;t=0}}r=r.right}return i},Sn=s=>{s.doc??O();const t=[];let e=s._start;for(;e!==null;){if(e.countable&&!e.deleted){const n=e.content.getContent();for(let i=0;i<n.length;i++)t.push(n[i])}e=e.right}return t},gt=(s,t)=>{let e=0,n=s._start;for(s.doc??O();n!==null;){if(n.countable&&!n.deleted){const i=n.content.getContent();for(let r=0;r<i.length;r++)t(i[r],e++,s)}n=n.right}},En=(s,t)=>{const e=[];return gt(s,(n,i)=>{e.push(t(n,i,s))}),e},ii=s=>{let t=s._start,e=null,n=0;return{[Symbol.iterator](){return this},next:()=>{if(e===null){for(;t!==null&&t.deleted;)t=t.right;if(t===null)return{done:!0,value:void 0};e=t.content.getContent(),n=0,t=t.right}const i=e[n++];return e.length<=n&&(e=null),{done:!1,value:i}}}},Cn=(s,t)=>{s.doc??O();const e=Jt(s,t);let n=s._start;for(e!==null&&(n=e.p,t-=e.index);n!==null;n=n.right)if(!n.deleted&&n.countable){if(t<n.length)return n.content.getContent()[t];t-=n.length}},Rt=(s,t,e,n)=>{let i=e;const r=s.doc,o=r.clientID,c=r.store,l=e===null?t._start:e.right;let a=[];const h=()=>{a.length>0&&(i=new b(w(o,C(c,o)),i,i&&i.lastId,l,l&&l.id,t,null,new G(a)),i.integrate(s,0),a=[])};n.forEach(u=>{if(u===null)a.push(u);else switch(u.constructor){case Number:case Object:case Boolean:case Array:case String:a.push(u);break;default:switch(h(),u.constructor){case Uint8Array:case ArrayBuffer:i=new b(w(o,C(c,o)),i,i&&i.lastId,l,l&&l.id,t,null,new yt(new Uint8Array(u))),i.integrate(s,0);break;case kt:i=new b(w(o,C(c,o)),i,i&&i.lastId,l,l&&l.id,t,null,new bt(u)),i.integrate(s,0);break;default:if(u instanceof I)i=new b(w(o,C(c,o)),i,i&&i.lastId,l,l&&l.id,t,null,new F(u)),i.integrate(s,0);else throw new Error("Unexpected content type in insert operation")}}}),h()},Dn=()=>Ot("Length exceeded!"),An=(s,t,e,n)=>{if(e>t._length)throw Dn();if(e===0)return t._searchMarker&&ft(t._searchMarker,e,n.length),Rt(s,t,null,n);const i=e,r=Jt(t,e);let o=t._start;for(r!==null&&(o=r.p,e-=r.index,e===0&&(o=o.prev,e+=o&&o.countable&&!o.deleted?o.length:0));o!==null;o=o.right)if(!o.deleted&&o.countable){if(e<=o.length){e<o.length&&N(s,w(o.id.client,o.id.clock+e));break}e-=o.length}return t._searchMarker&&ft(t._searchMarker,i,n.length),Rt(s,t,o,n)},ri=(s,t,e)=>{let i=(t._searchMarker||[]).reduce((r,o)=>o.index>r.index?o:r,{index:0,p:t._start}).p;if(i)for(;i.right;)i=i.right;return Rt(s,t,i,e)},In=(s,t,e,n)=>{if(n===0)return;const i=e,r=n,o=Jt(t,e);let c=t._start;for(o!==null&&(c=o.p,e-=o.index);c!==null&&e>0;c=c.right)!c.deleted&&c.countable&&(e<c.length&&N(s,w(c.id.client,c.id.clock+e)),e-=c.length);for(;n>0&&c!==null;)c.deleted||(n<c.length&&N(s,w(c.id.client,c.id.clock+n)),c.delete(s),n-=c.length),c=c.right;if(n>0)throw Dn();t._searchMarker&&ft(t._searchMarker,i,-r+n)},vt=(s,t,e)=>{const n=t._map.get(e);n!==void 0&&n.delete(s)},Oe=(s,t,e,n)=>{const i=t._map.get(e)||null,r=s.doc,o=r.clientID;let c;if(n==null)c=new G([n]);else switch(n.constructor){case Number:case Object:case Boolean:case Array:case String:c=new G([n]);break;case Uint8Array:c=new yt(n);break;case kt:c=new bt(n);break;default:if(n instanceof I)c=new F(n);else throw new Error("Unexpected content type")}new b(w(o,C(r.store,o)),i,i&&i.lastId,null,null,t,e,c).integrate(s,0)},Ne=(s,t)=>{s.doc??O();const e=s._map.get(t);return e!==void 0&&!e.deleted?e.content.getContent()[e.length-1]:void 0},On=s=>{const t={};return s.doc??O(),s._map.forEach((e,n)=>{e.deleted||(t[n]=e.content.getContent()[e.length-1])}),t},Nn=(s,t)=>{s.doc??O();const e=s._map.get(t);return e!==void 0&&!e.deleted},oi=(s,t)=>{const e={};return s._map.forEach((n,i)=>{let r=n;for(;r!==null&&(!t.sv.has(r.id.client)||r.id.clock>=(t.sv.get(r.id.client)||0));)r=r.left;r!==null&&Q(r,t)&&(e[i]=r.content.getContent()[r.length-1])}),e},Et=s=>(s.doc??O(),jn(s._map.entries(),t=>!t[1].deleted));class ci extends Yt{}class Z extends I{constructor(){super(),this._prelimContent=[],this._searchMarker=[]}static from(t){const e=new Z;return e.push(t),e}_integrate(t,e){super._integrate(t,e),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new Z}clone(){const t=new Z;return t.insert(0,this.toArray().map(e=>e instanceof I?e.clone():e)),t}get length(){return this.doc??O(),this._length}_callObserver(t,e){super._callObserver(t,e),Kt(this,t,new ci(this,t))}insert(t,e){this.doc!==null?_(this.doc,n=>{An(n,this,t,e)}):this._prelimContent.splice(t,0,...e)}push(t){this.doc!==null?_(this.doc,e=>{ri(e,this,t)}):this._prelimContent.push(...t)}unshift(t){this.insert(0,t)}delete(t,e=1){this.doc!==null?_(this.doc,n=>{In(n,this,t,e)}):this._prelimContent.splice(t,e)}get(t){return Cn(this,t)}toArray(){return Sn(this)}slice(t=0,e=this.length){return bn(this,t,e)}toJSON(){return this.map(t=>t instanceof I?t.toJSON():t)}map(t){return En(this,t)}forEach(t){gt(this,t)}[Symbol.iterator](){return ii(this)}_write(t){t.writeTypeRef(Ri)}}const li=s=>new Z;class hi extends Yt{constructor(t,e,n){super(t,e),this.keysChanged=n}}class nt extends I{constructor(t){super(),this._prelimContent=null,t===void 0?this._prelimContent=new Map:this._prelimContent=new Map(t)}_integrate(t,e){super._integrate(t,e),this._prelimContent.forEach((n,i)=>{this.set(i,n)}),this._prelimContent=null}_copy(){return new nt}clone(){const t=new nt;return this.forEach((e,n)=>{t.set(n,e instanceof I?e.clone():e)}),t}_callObserver(t,e){Kt(this,t,new hi(this,t,e))}toJSON(){this.doc??O();const t={};return this._map.forEach((e,n)=>{if(!e.deleted){const i=e.content.getContent()[e.length-1];t[n]=i instanceof I?i.toJSON():i}}),t}get size(){return[...Et(this)].length}keys(){return $t(Et(this),t=>t[0])}values(){return $t(Et(this),t=>t[1].content.getContent()[t[1].length-1])}entries(){return $t(Et(this),t=>[t[0],t[1].content.getContent()[t[1].length-1]])}forEach(t){this.doc??O(),this._map.forEach((e,n)=>{e.deleted||t(e.content.getContent()[e.length-1],n,this)})}[Symbol.iterator](){return this.entries()}delete(t){this.doc!==null?_(this.doc,e=>{vt(e,this,t)}):this._prelimContent.delete(t)}set(t,e){return this.doc!==null?_(this.doc,n=>{Oe(n,this,t,e)}):this._prelimContent.set(t,e),e}get(t){return Ne(this,t)}has(t){return Nn(this,t)}clear(){this.doc!==null?_(this.doc,t=>{this.forEach(function(e,n,i){vt(t,i,n)})}):this._prelimContent.clear()}_write(t){t.writeTypeRef(vi)}}const ai=s=>new nt,J=(s,t)=>s===t||typeof s=="object"&&typeof t=="object"&&s&&t&&rs(s,t);class pe{constructor(t,e,n,i){this.left=t,this.right=e,this.index=n,this.currentAttributes=i}forward(){switch(this.right===null&&B(),this.right.content.constructor){case D:this.right.deleted||ht(this.currentAttributes,this.right.content);break;default:this.right.deleted||(this.index+=this.right.length);break}this.left=this.right,this.right=this.right.right}}const Xe=(s,t,e)=>{for(;t.right!==null&&e>0;){switch(t.right.content.constructor){case D:t.right.deleted||ht(t.currentAttributes,t.right.content);break;default:t.right.deleted||(e<t.right.length&&N(s,w(t.right.id.client,t.right.id.clock+e)),t.index+=t.right.length,e-=t.right.length);break}t.left=t.right,t.right=t.right.right}return t},Ct=(s,t,e,n)=>{const i=new Map,r=n?Jt(t,e):null;if(r){const o=new pe(r.p.left,r.p,r.index,i);return Xe(s,o,e-r.index)}else{const o=new pe(null,t._start,0,i);return Xe(s,o,e)}},Ln=(s,t,e,n)=>{for(;e.right!==null&&(e.right.deleted===!0||e.right.content.constructor===D&&J(n.get(e.right.content.key),e.right.content.value));)e.right.deleted||n.delete(e.right.content.key),e.forward();const i=s.doc,r=i.clientID;n.forEach((o,c)=>{const l=e.left,a=e.right,h=new b(w(r,C(i.store,r)),l,l&&l.lastId,a,a&&a.id,t,null,new D(c,o));h.integrate(s,0),e.right=h,e.forward()})},ht=(s,t)=>{const{key:e,value:n}=t;n===null?s.delete(e):s.set(e,n)},Tn=(s,t)=>{for(;s.right!==null;){if(!(s.right.deleted||s.right.content.constructor===D&&J(t[s.right.content.key]??null,s.right.content.value)))break;s.forward()}},Rn=(s,t,e,n)=>{const i=s.doc,r=i.clientID,o=new Map;for(const c in n){const l=n[c],a=e.currentAttributes.get(c)??null;if(!J(a,l)){o.set(c,a);const{left:h,right:u}=e;e.right=new b(w(r,C(i.store,r)),h,h&&h.lastId,u,u&&u.id,t,null,new D(c,l)),e.right.integrate(s,0),e.forward()}}return o},ee=(s,t,e,n,i)=>{e.currentAttributes.forEach((d,f)=>{i[f]===void 0&&(i[f]=null)});const r=s.doc,o=r.clientID;Tn(e,i);const c=Rn(s,t,e,i),l=n.constructor===String?new U(n):n instanceof I?new F(n):new W(n);let{left:a,right:h,index:u}=e;t._searchMarker&&ft(t._searchMarker,e.index,l.getLength()),h=new b(w(o,C(r.store,o)),a,a&&a.lastId,h,h&&h.id,t,null,l),h.integrate(s,0),e.right=h,e.index=u,e.forward(),Ln(s,t,e,c)},Ze=(s,t,e,n,i)=>{const r=s.doc,o=r.clientID;Tn(e,i);const c=Rn(s,t,e,i);t:for(;e.right!==null&&(n>0||c.size>0&&(e.right.deleted||e.right.content.constructor===D));){if(!e.right.deleted)switch(e.right.content.constructor){case D:{const{key:l,value:a}=e.right.content,h=i[l];if(h!==void 0){if(J(h,a))c.delete(l);else{if(n===0)break t;c.set(l,a)}e.right.delete(s)}else e.currentAttributes.set(l,a);break}default:n<e.right.length&&N(s,w(e.right.id.client,e.right.id.clock+n)),n-=e.right.length;break}e.forward()}if(n>0){let l="";for(;n>0;n--)l+=`
`;e.right=new b(w(o,C(r.store,o)),e.left,e.left&&e.left.lastId,e.right,e.right&&e.right.id,t,null,new U(l)),e.right.integrate(s,0),e.forward()}Ln(s,t,e,c)},vn=(s,t,e,n,i)=>{let r=t;const o=we();for(;r&&(!r.countable||r.deleted);){if(!r.deleted&&r.content.constructor===D){const a=r.content;o.set(a.key,a)}r=r.right}let c=0,l=!1;for(;t!==r;){if(e===t&&(l=!0),!t.deleted){const a=t.content;switch(a.constructor){case D:{const{key:h,value:u}=a,d=n.get(h)??null;(o.get(h)!==a||d===u)&&(t.delete(s),c++,!l&&(i.get(h)??null)===u&&d!==u&&(d===null?i.delete(h):i.set(h,d))),!l&&!t.deleted&&ht(i,a);break}}}t=t.right}return c},ui=(s,t)=>{for(;t&&t.right&&(t.right.deleted||!t.right.countable);)t=t.right;const e=new Set;for(;t&&(t.deleted||!t.countable);){if(!t.deleted&&t.content.constructor===D){const n=t.content.key;e.has(n)?t.delete(s):e.add(n)}t=t.left}},di=s=>{let t=0;return _(s.doc,e=>{let n=s._start,i=s._start,r=we();const o=se(r);for(;i;){if(i.deleted===!1)switch(i.content.constructor){case D:ht(o,i.content);break;default:t+=vn(e,n,i,r,o),r=se(o),n=i;break}i=i.right}}),t},fi=s=>{const t=new Set,e=s.doc;for(const[n,i]of s.afterState.entries()){const r=s.beforeState.get(n)||0;i!==r&&wn(s,e.store.clients.get(n),r,i,o=>{!o.deleted&&o.content.constructor===D&&o.constructor!==L&&t.add(o.parent)})}_(e,n=>{tt(s,s.deleteSet,i=>{if(i instanceof L||!i.parent._hasFormatting||t.has(i.parent))return;const r=i.parent;i.content.constructor===D?t.add(r):ui(n,i)});for(const i of t)di(i)})},Pe=(s,t,e)=>{const n=e,i=se(t.currentAttributes),r=t.right;for(;e>0&&t.right!==null;){if(t.right.deleted===!1)switch(t.right.content.constructor){case F:case W:case U:e<t.right.length&&N(s,w(t.right.id.client,t.right.id.clock+e)),e-=t.right.length,t.right.delete(s);break}t.forward()}r&&vn(s,r,t.right,i,t.currentAttributes);const o=(t.left||t.right).parent;return o._searchMarker&&ft(o._searchMarker,t.index,-n+e),t};class gi extends Yt{constructor(t,e,n){super(t,e),this.childListChanged=!1,this.keysChanged=new Set,n.forEach(i=>{i===null?this.childListChanged=!0:this.keysChanged.add(i)})}get changes(){if(this._changes===null){const t={keys:this.keys,delta:this.delta,added:new Set,deleted:new Set};this._changes=t}return this._changes}get delta(){if(this._delta===null){const t=this.target.doc,e=[];_(t,n=>{const i=new Map,r=new Map;let o=this.target._start,c=null;const l={};let a="",h=0,u=0;const d=()=>{if(c!==null){let f=null;switch(c){case"delete":u>0&&(f={delete:u}),u=0;break;case"insert":(typeof a=="object"||a.length>0)&&(f={insert:a},i.size>0&&(f.attributes={},i.forEach((g,p)=>{g!==null&&(f.attributes[p]=g)}))),a="";break;case"retain":h>0&&(f={retain:h},Wn(l)||(f.attributes=Qn({},l))),h=0;break}f&&e.push(f),c=null}};for(;o!==null;){switch(o.content.constructor){case F:case W:this.adds(o)?this.deletes(o)||(d(),c="insert",a=o.content.getContent()[0],d()):this.deletes(o)?(c!=="delete"&&(d(),c="delete"),u+=1):o.deleted||(c!=="retain"&&(d(),c="retain"),h+=1);break;case U:this.adds(o)?this.deletes(o)||(c!=="insert"&&(d(),c="insert"),a+=o.content.str):this.deletes(o)?(c!=="delete"&&(d(),c="delete"),u+=o.length):o.deleted||(c!=="retain"&&(d(),c="retain"),h+=o.length);break;case D:{const{key:f,value:g}=o.content;if(this.adds(o)){if(!this.deletes(o)){const p=i.get(f)??null;J(p,g)?g!==null&&o.delete(n):(c==="retain"&&d(),J(g,r.get(f)??null)?delete l[f]:l[f]=g)}}else if(this.deletes(o)){r.set(f,g);const p=i.get(f)??null;J(p,g)||(c==="retain"&&d(),l[f]=p)}else if(!o.deleted){r.set(f,g);const p=l[f];p!==void 0&&(J(p,g)?p!==null&&o.delete(n):(c==="retain"&&d(),g===null?delete l[f]:l[f]=g))}o.deleted||(c==="insert"&&d(),ht(i,o.content));break}}o=o.right}for(d();e.length>0;){const f=e[e.length-1];if(f.retain!==void 0&&f.attributes===void 0)e.pop();else break}}),this._delta=e}return this._delta}}class st extends I{constructor(t){super(),this._pending=t!==void 0?[()=>this.insert(0,t)]:[],this._searchMarker=[],this._hasFormatting=!1}get length(){return this.doc??O(),this._length}_integrate(t,e){super._integrate(t,e);try{this._pending.forEach(n=>n())}catch(n){console.error(n)}this._pending=null}_copy(){return new st}clone(){const t=new st;return t.applyDelta(this.toDelta()),t}_callObserver(t,e){super._callObserver(t,e);const n=new gi(this,t,e);Kt(this,t,n),!t.local&&this._hasFormatting&&(t._needFormattingCleanup=!0)}toString(){this.doc??O();let t="",e=this._start;for(;e!==null;)!e.deleted&&e.countable&&e.content.constructor===U&&(t+=e.content.str),e=e.right;return t}toJSON(){return this.toString()}applyDelta(t,{sanitize:e=!0}={}){this.doc!==null?_(this.doc,n=>{const i=new pe(null,this._start,0,new Map);for(let r=0;r<t.length;r++){const o=t[r];if(o.insert!==void 0){const c=!e&&typeof o.insert=="string"&&r===t.length-1&&i.right===null&&o.insert.slice(-1)===`
`?o.insert.slice(0,-1):o.insert;(typeof c!="string"||c.length>0)&&ee(n,this,i,c,o.attributes||{})}else o.retain!==void 0?Ze(n,this,i,o.retain,o.attributes||{}):o.delete!==void 0&&Pe(n,i,o.delete)}}):this._pending.push(()=>this.applyDelta(t))}toDelta(t,e,n){this.doc??O();const i=[],r=new Map,o=this.doc;let c="",l=this._start;function a(){if(c.length>0){const u={};let d=!1;r.forEach((g,p)=>{d=!0,u[p]=g});const f={insert:c};d&&(f.attributes=u),i.push(f),c=""}}const h=()=>{for(;l!==null;){if(Q(l,t)||e!==void 0&&Q(l,e))switch(l.content.constructor){case U:{const u=r.get("ychange");t!==void 0&&!Q(l,t)?(u===void 0||u.user!==l.id.client||u.type!=="removed")&&(a(),r.set("ychange",n?n("removed",l.id):{type:"removed"})):e!==void 0&&!Q(l,e)?(u===void 0||u.user!==l.id.client||u.type!=="added")&&(a(),r.set("ychange",n?n("added",l.id):{type:"added"})):u!==void 0&&(a(),r.delete("ychange")),c+=l.content.str;break}case F:case W:{a();const u={insert:l.content.getContent()[0]};if(r.size>0){const d={};u.attributes=d,r.forEach((f,g)=>{d[g]=f})}i.push(u);break}case D:Q(l,t)&&(a(),ht(r,l.content));break}l=l.right}a()};return t||e?_(o,u=>{t&&fe(u,t),e&&fe(u,e),h()},"cleanup"):h(),i}insert(t,e,n){if(e.length<=0)return;const i=this.doc;i!==null?_(i,r=>{const o=Ct(r,this,t,!n);n||(n={},o.currentAttributes.forEach((c,l)=>{n[l]=c})),ee(r,this,o,e,n)}):this._pending.push(()=>this.insert(t,e,n))}insertEmbed(t,e,n){const i=this.doc;i!==null?_(i,r=>{const o=Ct(r,this,t,!n);ee(r,this,o,e,n||{})}):this._pending.push(()=>this.insertEmbed(t,e,n||{}))}delete(t,e){if(e===0)return;const n=this.doc;n!==null?_(n,i=>{Pe(i,Ct(i,this,t,!0),e)}):this._pending.push(()=>this.delete(t,e))}format(t,e,n){if(e===0)return;const i=this.doc;i!==null?_(i,r=>{const o=Ct(r,this,t,!1);o.right!==null&&Ze(r,this,o,e,n)}):this._pending.push(()=>this.format(t,e,n))}removeAttribute(t){this.doc!==null?_(this.doc,e=>{vt(e,this,t)}):this._pending.push(()=>this.removeAttribute(t))}setAttribute(t,e){this.doc!==null?_(this.doc,n=>{Oe(n,this,t,e)}):this._pending.push(()=>this.setAttribute(t,e))}getAttribute(t){return Ne(this,t)}getAttributes(){return On(this)}_write(t){t.writeTypeRef(xi)}}const pi=s=>new st;class ne{constructor(t,e=()=>!0){this._filter=e,this._root=t,this._currentNode=t._start,this._firstCall=!0,t.doc??O()}[Symbol.iterator](){return this}next(){let t=this._currentNode,e=t&&t.content&&t.content.type;if(t!==null&&(!this._firstCall||t.deleted||!this._filter(e)))do if(e=t.content.type,!t.deleted&&(e.constructor===it||e.constructor===q)&&e._start!==null)t=e._start;else for(;t!==null;)if(t.right!==null){t=t.right;break}else t.parent===this._root?t=null:t=t.parent._item;while(t!==null&&(t.deleted||!this._filter(t.content.type)));return this._firstCall=!1,t===null?{value:void 0,done:!0}:(this._currentNode=t,{value:t.content.type,done:!1})}}class q extends I{constructor(){super(),this._prelimContent=[]}get firstChild(){const t=this._first;return t?t.content.getContent()[0]:null}_integrate(t,e){super._integrate(t,e),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new q}clone(){const t=new q;return t.insert(0,this.toArray().map(e=>e instanceof I?e.clone():e)),t}get length(){return this.doc??O(),this._prelimContent===null?this._length:this._prelimContent.length}createTreeWalker(t){return new ne(this,t)}querySelector(t){t=t.toUpperCase();const n=new ne(this,i=>i.nodeName&&i.nodeName.toUpperCase()===t).next();return n.done?null:n.value}querySelectorAll(t){return t=t.toUpperCase(),P(new ne(this,e=>e.nodeName&&e.nodeName.toUpperCase()===t))}_callObserver(t,e){Kt(this,t,new ki(this,e,t))}toString(){return En(this,t=>t.toString()).join("")}toJSON(){return this.toString()}toDOM(t=document,e={},n){const i=t.createDocumentFragment();return n!==void 0&&n._createAssociation(i,this),gt(this,r=>{i.insertBefore(r.toDOM(t,e,n),null)}),i}insert(t,e){this.doc!==null?_(this.doc,n=>{An(n,this,t,e)}):this._prelimContent.splice(t,0,...e)}insertAfter(t,e){if(this.doc!==null)_(this.doc,n=>{const i=t&&t instanceof I?t._item:t;Rt(n,this,i,e)});else{const n=this._prelimContent,i=t===null?0:n.findIndex(r=>r===t)+1;if(i===0&&t!==null)throw Ot("Reference item not found");n.splice(i,0,...e)}}delete(t,e=1){this.doc!==null?_(this.doc,n=>{In(n,this,t,e)}):this._prelimContent.splice(t,e)}toArray(){return Sn(this)}push(t){this.insert(this.length,t)}unshift(t){this.insert(0,t)}get(t){return Cn(this,t)}slice(t=0,e=this.length){return bn(this,t,e)}forEach(t){gt(this,t)}_write(t){t.writeTypeRef(Bi)}}const wi=s=>new q;class it extends q{constructor(t="UNDEFINED"){super(),this.nodeName=t,this._prelimAttrs=new Map}get nextSibling(){const t=this._item?this._item.next:null;return t?t.content.type:null}get prevSibling(){const t=this._item?this._item.prev:null;return t?t.content.type:null}_integrate(t,e){super._integrate(t,e),this._prelimAttrs.forEach((n,i)=>{this.setAttribute(i,n)}),this._prelimAttrs=null}_copy(){return new it(this.nodeName)}clone(){const t=new it(this.nodeName),e=this.getAttributes();return Hn(e,(n,i)=>{typeof n=="string"&&t.setAttribute(i,n)}),t.insert(0,this.toArray().map(n=>n instanceof I?n.clone():n)),t}toString(){const t=this.getAttributes(),e=[],n=[];for(const c in t)n.push(c);n.sort();const i=n.length;for(let c=0;c<i;c++){const l=n[c];e.push(l+'="'+t[l]+'"')}const r=this.nodeName.toLocaleLowerCase(),o=e.length>0?" "+e.join(" "):"";return`<${r}${o}>${super.toString()}</${r}>`}removeAttribute(t){this.doc!==null?_(this.doc,e=>{vt(e,this,t)}):this._prelimAttrs.delete(t)}setAttribute(t,e){this.doc!==null?_(this.doc,n=>{Oe(n,this,t,e)}):this._prelimAttrs.set(t,e)}getAttribute(t){return Ne(this,t)}hasAttribute(t){return Nn(this,t)}getAttributes(t){return t?oi(this,t):On(this)}toDOM(t=document,e={},n){const i=t.createElement(this.nodeName),r=this.getAttributes();for(const o in r){const c=r[o];typeof c=="string"&&i.setAttribute(o,c)}return gt(this,o=>{i.appendChild(o.toDOM(t,e,n))}),n!==void 0&&n._createAssociation(i,this),i}_write(t){t.writeTypeRef(Mi),t.writeKey(this.nodeName)}}const mi=s=>new it(s.readKey());class ki extends Yt{constructor(t,e,n){super(t,n),this.childListChanged=!1,this.attributesChanged=new Set,e.forEach(i=>{i===null?this.childListChanged=!0:this.attributesChanged.add(i)})}}class xt extends nt{constructor(t){super(),this.hookName=t}_copy(){return new xt(this.hookName)}clone(){const t=new xt(this.hookName);return this.forEach((e,n)=>{t.set(n,e)}),t}toDOM(t=document,e={},n){const i=e[this.hookName];let r;return i!==void 0?r=i.createDom(this):r=document.createElement(this.hookName),r.setAttribute("data-yjs-hook",this.hookName),n!==void 0&&n._createAssociation(r,this),r}_write(t){t.writeTypeRef(Vi),t.writeKey(this.hookName)}}const _i=s=>new xt(s.readKey());class Mt extends st{get nextSibling(){const t=this._item?this._item.next:null;return t?t.content.type:null}get prevSibling(){const t=this._item?this._item.prev:null;return t?t.content.type:null}_copy(){return new Mt}clone(){const t=new Mt;return t.applyDelta(this.toDelta()),t}toDOM(t=document,e,n){const i=t.createTextNode(this.toString());return n!==void 0&&n._createAssociation(i,this),i}toString(){return this.toDelta().map(t=>{const e=[];for(const i in t.attributes){const r=[];for(const o in t.attributes[i])r.push({key:o,value:t.attributes[i][o]});r.sort((o,c)=>o.key<c.key?-1:1),e.push({nodeName:i,attrs:r})}e.sort((i,r)=>i.nodeName<r.nodeName?-1:1);let n="";for(let i=0;i<e.length;i++){const r=e[i];n+=`<${r.nodeName}`;for(let o=0;o<r.attrs.length;o++){const c=r.attrs[o];n+=` ${c.key}="${c.value}"`}n+=">"}n+=t.insert;for(let i=e.length-1;i>=0;i--)n+=`</${e[i].nodeName}>`;return n}).join("")}toJSON(){return this.toString()}_write(t){t.writeTypeRef(Ui)}}const yi=s=>new Mt;class Le{constructor(t,e){this.id=t,this.length=e}get deleted(){throw M()}mergeWith(t){return!1}write(t,e,n){throw M()}integrate(t,e){throw M()}}const bi=0;class L extends Le{get deleted(){return!0}delete(){}mergeWith(t){return this.constructor!==t.constructor?!1:(this.length+=t.length,!0)}integrate(t,e){e>0&&(this.id.clock+=e,this.length-=e),pn(t.doc.store,this)}write(t,e){t.writeInfo(bi),t.writeLen(this.length-e)}getMissing(t,e){return null}}class yt{constructor(t){this.content=t}getLength(){return 1}getContent(){return[this.content]}isCountable(){return!0}copy(){return new yt(this.content)}splice(t){throw M()}mergeWith(t){return!1}integrate(t,e){}delete(t){}gc(t){}write(t,e){t.writeBuf(this.content)}getRef(){return 3}}const Si=s=>new yt(s.readBuf());class pt{constructor(t){this.len=t}getLength(){return this.len}getContent(){return[]}isCountable(){return!1}copy(){return new pt(this.len)}splice(t){const e=new pt(this.len-t);return this.len=t,e}mergeWith(t){return this.len+=t.len,!0}integrate(t,e){dt(t.deleteSet,e.id.client,e.id.clock,this.len),e.markDeleted()}delete(t){}gc(t){}write(t,e){t.writeLen(this.len-e)}getRef(){return 1}}const Ei=s=>new pt(s.readLen()),xn=(s,t)=>new kt({guid:s,...t,shouldLoad:t.shouldLoad||t.autoLoad||!1});class bt{constructor(t){t._item&&console.error("This document was already integrated as a sub-document. You should create a second instance instead with the same guid."),this.doc=t;const e={};this.opts=e,t.gc||(e.gc=!1),t.autoLoad&&(e.autoLoad=!0),t.meta!==null&&(e.meta=t.meta)}getLength(){return 1}getContent(){return[this.doc]}isCountable(){return!0}copy(){return new bt(xn(this.doc.guid,this.opts))}splice(t){throw M()}mergeWith(t){return!1}integrate(t,e){this.doc._item=e,t.subdocsAdded.add(this.doc),this.doc.shouldLoad&&t.subdocsLoaded.add(this.doc)}delete(t){t.subdocsAdded.has(this.doc)?t.subdocsAdded.delete(this.doc):t.subdocsRemoved.add(this.doc)}gc(t){}write(t,e){t.writeString(this.doc.guid),t.writeAny(this.opts)}getRef(){return 9}}const Ci=s=>new bt(xn(s.readString(),s.readAny()));class W{constructor(t){this.embed=t}getLength(){return 1}getContent(){return[this.embed]}isCountable(){return!0}copy(){return new W(this.embed)}splice(t){throw M()}mergeWith(t){return!1}integrate(t,e){}delete(t){}gc(t){}write(t,e){t.writeJSON(this.embed)}getRef(){return 5}}const Di=s=>new W(s.readJSON());class D{constructor(t,e){this.key=t,this.value=e}getLength(){return 1}getContent(){return[]}isCountable(){return!1}copy(){return new D(this.key,this.value)}splice(t){throw M()}mergeWith(t){return!1}integrate(t,e){const n=e.parent;n._searchMarker=null,n._hasFormatting=!0}delete(t){}gc(t){}write(t,e){t.writeKey(this.key),t.writeJSON(this.value)}getRef(){return 6}}const Ai=s=>new D(s.readKey(),s.readJSON());class Bt{constructor(t){this.arr=t}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new Bt(this.arr)}splice(t){const e=new Bt(this.arr.slice(t));return this.arr=this.arr.slice(0,t),e}mergeWith(t){return this.arr=this.arr.concat(t.arr),!0}integrate(t,e){}delete(t){}gc(t){}write(t,e){const n=this.arr.length;t.writeLen(n-e);for(let i=e;i<n;i++){const r=this.arr[i];t.writeString(r===void 0?"undefined":JSON.stringify(r))}}getRef(){return 2}}const Ii=s=>{const t=s.readLen(),e=[];for(let n=0;n<t;n++){const i=s.readString();i==="undefined"?e.push(void 0):e.push(JSON.parse(i))}return new Bt(e)},Oi=zn("node_env")==="development";class G{constructor(t){this.arr=t,Oi&&Xn(t)}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new G(this.arr)}splice(t){const e=new G(this.arr.slice(t));return this.arr=this.arr.slice(0,t),e}mergeWith(t){return this.arr=this.arr.concat(t.arr),!0}integrate(t,e){}delete(t){}gc(t){}write(t,e){const n=this.arr.length;t.writeLen(n-e);for(let i=e;i<n;i++){const r=this.arr[i];t.writeAny(r)}}getRef(){return 8}}const Ni=s=>{const t=s.readLen(),e=[];for(let n=0;n<t;n++)e.push(s.readAny());return new G(e)};class U{constructor(t){this.str=t}getLength(){return this.str.length}getContent(){return this.str.split("")}isCountable(){return!0}copy(){return new U(this.str)}splice(t){const e=new U(this.str.slice(t));this.str=this.str.slice(0,t);const n=this.str.charCodeAt(t-1);return n>=55296&&n<=56319&&(this.str=this.str.slice(0,t-1)+"",e.str=""+e.str.slice(1)),e}mergeWith(t){return this.str+=t.str,!0}integrate(t,e){}delete(t){}gc(t){}write(t,e){t.writeString(e===0?this.str:this.str.slice(e))}getRef(){return 4}}const Li=s=>new U(s.readString()),Ti=[li,ai,pi,mi,wi,_i,yi],Ri=0,vi=1,xi=2,Mi=3,Bi=4,Vi=5,Ui=6;class F{constructor(t){this.type=t}getLength(){return 1}getContent(){return[this.type]}isCountable(){return!0}copy(){return new F(this.type._copy())}splice(t){throw M()}mergeWith(t){return!1}integrate(t,e){this.type._integrate(t.doc,e)}delete(t){let e=this.type._start;for(;e!==null;)e.deleted?e.id.clock<(t.beforeState.get(e.id.client)||0)&&t._mergeStructs.push(e):e.delete(t),e=e.right;this.type._map.forEach(n=>{n.deleted?n.id.clock<(t.beforeState.get(n.id.client)||0)&&t._mergeStructs.push(n):n.delete(t)}),t.changed.delete(this.type)}gc(t){let e=this.type._start;for(;e!==null;)e.gc(t,!0),e=e.right;this.type._start=null,this.type._map.forEach(n=>{for(;n!==null;)n.gc(t,!0),n=n.left}),this.type._map=new Map}write(t,e){this.type._write(t)}getRef(){return 7}}const Fi=s=>new F(Ti[s.readTypeRef()](s)),Yi=(s,t)=>{let e=t,n=0,i;do n>0&&(e=w(e.client,e.clock+n)),i=At(s,e),n=e.clock-i.id.clock,e=i.redone;while(e!==null&&i instanceof b);return{item:i,diff:n}},Te=(s,t)=>{for(;s!==null&&s.keep!==t;)s.keep=t,s=s.parent._item},Vt=(s,t,e)=>{const{client:n,clock:i}=t.id,r=new b(w(n,i+e),t,w(n,i+e-1),t.right,t.rightOrigin,t.parent,t.parentSub,t.content.splice(e));return t.deleted&&r.markDeleted(),t.keep&&(r.keep=!0),t.redone!==null&&(r.redone=w(t.redone.client,t.redone.clock+e)),t.right=r,r.right!==null&&(r.right.left=r),s._mergeStructs.push(r),r.parentSub!==null&&r.right===null&&r.parent._map.set(r.parentSub,r),t.length=e,r},tn=(s,t)=>us(s,e=>mt(e.deletions,t)),Mn=(s,t,e,n,i,r)=>{const o=s.doc,c=o.store,l=o.clientID,a=t.redone;if(a!==null)return N(s,a);let h=t.parent._item,u=null,d;if(h!==null&&h.deleted===!0){if(h.redone===null&&(!e.has(h)||Mn(s,h,e,n,i,r)===null))return null;for(;h.redone!==null;)h=N(s,h.redone)}const f=h===null?t.parent:h.content.type;if(t.parentSub===null){for(u=t.left,d=t;u!==null;){let E=u;for(;E!==null&&E.parent._item!==h;)E=E.redone===null?null:N(s,E.redone);if(E!==null&&E.parent._item===h){u=E;break}u=u.left}for(;d!==null;){let E=d;for(;E!==null&&E.parent._item!==h;)E=E.redone===null?null:N(s,E.redone);if(E!==null&&E.parent._item===h){d=E;break}d=d.right}}else if(d=null,t.right&&!i){for(u=t;u!==null&&u.right!==null&&(u.right.redone||mt(n,u.right.id)||tn(r.undoStack,u.right.id)||tn(r.redoStack,u.right.id));)for(u=u.right;u.redone;)u=N(s,u.redone);if(u&&u.right!==null)return null}else u=f._map.get(t.parentSub)||null;const g=C(c,l),p=w(l,g),S=new b(p,u,u&&u.lastId,d,d&&d.id,f,t.parentSub,t.content.copy());return t.redone=p,Te(S,!0),S.integrate(s,0),S};class b extends Le{constructor(t,e,n,i,r,o,c,l){super(t,l.getLength()),this.origin=n,this.left=e,this.right=i,this.rightOrigin=r,this.parent=o,this.parentSub=c,this.redone=null,this.content=l,this.info=this.content.isCountable()?Me:0}set marker(t){(this.info&zt)>0!==t&&(this.info^=zt)}get marker(){return(this.info&zt)>0}get keep(){return(this.info&Be)>0}set keep(t){this.keep!==t&&(this.info^=Be)}get countable(){return(this.info&Me)>0}get deleted(){return(this.info&qt)>0}set deleted(t){this.deleted!==t&&(this.info^=qt)}markDeleted(){this.info|=qt}getMissing(t,e){if(this.origin&&this.origin.client!==this.id.client&&this.origin.clock>=C(e,this.origin.client))return this.origin.client;if(this.rightOrigin&&this.rightOrigin.client!==this.id.client&&this.rightOrigin.clock>=C(e,this.rightOrigin.client))return this.rightOrigin.client;if(this.parent&&this.parent.constructor===X&&this.id.client!==this.parent.client&&this.parent.clock>=C(e,this.parent.client))return this.parent.client;if(this.origin&&(this.left=ze(t,e,this.origin),this.origin=this.left.lastId),this.rightOrigin&&(this.right=N(t,this.rightOrigin),this.rightOrigin=this.right.id),this.left&&this.left.constructor===L||this.right&&this.right.constructor===L)this.parent=null;else if(!this.parent)this.left&&this.left.constructor===b&&(this.parent=this.left.parent,this.parentSub=this.left.parentSub),this.right&&this.right.constructor===b&&(this.parent=this.right.parent,this.parentSub=this.right.parentSub);else if(this.parent.constructor===X){const n=At(e,this.parent);n.constructor===L?this.parent=null:this.parent=n.content.type}return null}integrate(t,e){if(e>0&&(this.id.clock+=e,this.left=ze(t,t.doc.store,w(this.id.client,this.id.clock-1)),this.origin=this.left.lastId,this.content=this.content.splice(e),this.length-=e),this.parent){if(!this.left&&(!this.right||this.right.left!==null)||this.left&&this.left.right!==this.right){let n=this.left,i;if(n!==null)i=n.right;else if(this.parentSub!==null)for(i=this.parent._map.get(this.parentSub)||null;i!==null&&i.left!==null;)i=i.left;else i=this.parent._start;const r=new Set,o=new Set;for(;i!==null&&i!==this.right;){if(o.add(i),r.add(i),St(this.origin,i.origin)){if(i.id.client<this.id.client)n=i,r.clear();else if(St(this.rightOrigin,i.rightOrigin))break}else if(i.origin!==null&&o.has(At(t.doc.store,i.origin)))r.has(At(t.doc.store,i.origin))||(n=i,r.clear());else break;i=i.right}this.left=n}if(this.left!==null){const n=this.left.right;this.right=n,this.left.right=this}else{let n;if(this.parentSub!==null)for(n=this.parent._map.get(this.parentSub)||null;n!==null&&n.left!==null;)n=n.left;else n=this.parent._start,this.parent._start=this;this.right=n}this.right!==null?this.right.left=this:this.parentSub!==null&&(this.parent._map.set(this.parentSub,this),this.left!==null&&this.left.delete(t)),this.parentSub===null&&this.countable&&!this.deleted&&(this.parent._length+=this.length),pn(t.doc.store,this),this.content.integrate(t,this),Ge(t,this.parent,this.parentSub),(this.parent._item!==null&&this.parent._item.deleted||this.parentSub!==null&&this.right!==null)&&this.delete(t)}else new L(this.id,this.length).integrate(t,0)}get next(){let t=this.right;for(;t!==null&&t.deleted;)t=t.right;return t}get prev(){let t=this.left;for(;t!==null&&t.deleted;)t=t.left;return t}get lastId(){return this.length===1?this.id:w(this.id.client,this.id.clock+this.length-1)}mergeWith(t){if(this.constructor===t.constructor&&St(t.origin,this.lastId)&&this.right===t&&St(this.rightOrigin,t.rightOrigin)&&this.id.client===t.id.client&&this.id.clock+this.length===t.id.clock&&this.deleted===t.deleted&&this.redone===null&&t.redone===null&&this.content.constructor===t.content.constructor&&this.content.mergeWith(t.content)){const e=this.parent._searchMarker;return e&&e.forEach(n=>{n.p===t&&(n.p=this,!this.deleted&&this.countable&&(n.index-=this.length))}),t.keep&&(this.keep=!0),this.right=t.right,this.right!==null&&(this.right.left=this),this.length+=t.length,!0}return!1}delete(t){if(!this.deleted){const e=this.parent;this.countable&&this.parentSub===null&&(e._length-=this.length),this.markDeleted(),dt(t.deleteSet,this.id.client,this.id.clock,this.length),Ge(t,e,this.parentSub),this.content.delete(t)}}gc(t,e){if(!this.deleted)throw B();this.content.gc(t),e?$s(t,this,new L(this.id,this.length)):this.content=new pt(this.length)}write(t,e){const n=e>0?w(this.id.client,this.id.clock+e-1):this.origin,i=this.rightOrigin,r=this.parentSub,o=this.content.getRef()&Ut|(n===null?0:$)|(i===null?0:H)|(r===null?0:ut);if(t.writeInfo(o),n!==null&&t.writeLeftID(n),i!==null&&t.writeRightID(i),n===null&&i===null){const c=this.parent;if(c._item!==void 0){const l=c._item;if(l===null){const a=Js(c);t.writeParentInfo(!0),t.writeString(a)}else t.writeParentInfo(!1),t.writeLeftID(l.id)}else c.constructor===String?(t.writeParentInfo(!0),t.writeString(c)):c.constructor===X?(t.writeParentInfo(!1),t.writeLeftID(c)):B();r!==null&&t.writeString(r)}this.content.write(t,e)}}const Bn=(s,t)=>Ji[t&Ut](s),Ji=[()=>{B()},Ei,Ii,Si,Li,Di,Ai,Fi,Ni,Ci,()=>{B()}],Ki=10;class T extends Le{get deleted(){return!0}delete(){}mergeWith(t){return this.constructor!==t.constructor?!1:(this.length+=t.length,!0)}integrate(t,e){B()}write(t,e){t.writeInfo(Ki),y(t.restEncoder,this.length-e)}getMissing(t,e){return null}}const Vn=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:{},Un="__ $YJS$ __";Vn[Un]===!0&&console.error("Yjs was already imported. This breaks constructor checks and will lead to issues! - https://github.com/yjs/yjs/issues/438");Vn[Un]=!0;export{kt as D,A as E,qi as U,Hi as a,zi as e,te as l,_ as t};
