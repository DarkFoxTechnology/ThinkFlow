import{D as Rt,I as Ht,l as Ut,t as Bt,d as Ft,r as E,U as Gt,c as H,o as ct,v as Yt,a as T,b as M,e as C,w as St,f as kt,g as Nt,n as et,h as at,i as rt,j as tt,k as Xt,m as Kt,u as $t,p as At,q as zt,s as vt,F as mt,x as It,y as Vt,z as Wt,A as qt,B as jt}from"./vendor-DeLnJycc.js";(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const d of document.querySelectorAll('link[rel="modulepreload"]'))o(d);new MutationObserver(d=>{for(const y of d)if(y.type==="childList")for(const s of y.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&o(s)}).observe(document,{childList:!0,subtree:!0});function f(d){const y={};return d.integrity&&(y.integrity=d.integrity),d.referrerPolicy&&(y.referrerPolicy=d.referrerPolicy),d.crossOrigin==="use-credentials"?y.credentials="include":d.crossOrigin==="anonymous"?y.credentials="omit":y.credentials="same-origin",y}function o(d){if(d.ep)return;d.ep=!0;const y=f(d);fetch(d.href,y)}})();const ot=new Rt,v=ot.getMap("mindmap"),Tt=new Ht("mindmap-storage",ot),q=Ut("ws://localhost:5173",{autoConnect:!1,reconnection:!0,reconnectionAttempts:5,reconnectionDelay:1e3,transports:["websocket"]});q.on("connect",()=>{console.log("Connected to server"),q.emit("sync",v.toJSON())});q.on("disconnect",()=>{console.log("Disconnected from server")});q.on("connect_error",l=>{console.error("Connection error:",l.message)});v.observe(l=>{if(!l.transaction.local)return;const r=l.changes.keys;for(const[f,o]of r){const d=v.get(f);q.emit("update",{key:f,value:d})}});q.on("update",({key:l,value:r})=>{Bt(ot,()=>{v.set(l,r)})});Tt.on("synced",()=>{console.log("Content synced with IndexedDB")});Tt.on("error",l=>{console.error("IndexedDB error:",l)});const bt={HORIZONTAL_SPACING:200,VERTICAL_SPACING:60,NODE_WIDTH:120,NODE_HEIGHT:40};function Zt(l){if(!l.length)return"";const r=new Map(l.map(d=>[d.id,d])),f=l.filter(d=>!d.parentId);function o(d,y=0){const s=r.get(d);if(!s)return"";let w=`${"  ".repeat(y)}${y===0?"#":"-"} ${s.content}
`;return l.filter(k=>k.parentId===d).sort((k,L)=>{const A=k.position||{y:0},B=L.position||{y:0};return A.y-B.y}).forEach(k=>{w+=o(k.id,y+1)}),w}return f.sort((d,y)=>d.position.y-y.position.y).map(d=>o(d.id)).join(`
`)}function Jt(l){const r=l.split(`
`).filter(d=>d.trim()),f=[],o=[];return r.forEach(d=>{const y=d.match(/^(\s*)([#-])\s+(.+)$/);if(!y)return;const[,s,g,S]=y,w=g==="#"?0:s.length/2+1;for(;o.length>0&&o[o.length-1].level>=w;)o.pop();const u={id:te(),content:S.trim(),parentId:o.length>0?o[o.length-1].id:null,position:{x:0,y:0},style:{backgroundColor:"#ffffff",textColor:"#333333",borderColor:"#ddd"}};f.push(u),o.push({id:u.id,level:w}),u.id}),_t(f)}function _t(l){if(!l.length)return l;const r=l.filter(s=>!s.parentId);if(!r.length)return l;const f=new Map(l.map(s=>[s.id,{...s}]));r.forEach(s=>{Mt(s.id,0,f)});const o=Array.from(f.values()).sort((s,g)=>s.level!==g.level?s.level-g.level:s.parentId===g.parentId?s.index-g.index:0);let d=0,y=0;return o.forEach(s=>{s.level!==d&&(d=s.level);const g=o.filter(u=>u.parentId===s.parentId&&u.level===s.level),w=-(g.length*bt.VERTICAL_SPACING)/2;s.position={x:s.level*bt.HORIZONTAL_SPACING,y:w+g.indexOf(s)*bt.VERTICAL_SPACING},y=Math.max(y,Math.abs(s.position.y))}),o.forEach(s=>{s.position.y+=y}),o}function Mt(l,r,f,o=0){const d=f.get(l);if(!d)return;d.level=r,d.index=o,Array.from(f.values()).filter(s=>s.parentId===l).sort((s,g)=>{const S=s.position||{y:0},w=g.position||{y:0};return S.y-w.y}).forEach((s,g)=>{Mt(s.id,r+1,f,g)})}function Qt(l,r){if(!r)return[];const f=r.toLowerCase();return l.filter(o=>{var y;return(((y=o.content)==null?void 0:y.toLowerCase())||"").includes(f)})}function te(){return`node_${Math.random().toString(36).substr(2,9)}`}const Lt=Ft("mindmap",()=>{const l=E(!0),r=E([]),f=E(null),o=new Gt(v),y=(()=>{const i=()=>{l.value=!1};return v.observe(i),()=>v.unobserve(i)})(),g=(()=>{const i=setInterval(()=>{const a=v.toJSON();localStorage.setItem("mindmap-autosave",JSON.stringify(a))},5e3);return()=>clearInterval(i)})();function S(i){var e;const a=new Set,t=[];for(const n of i)(e=n.style)!=null&&e.collapsed&&a.add(n.id);for(const n of i)a.has(n.parentId)||t.push(n);return t}function w(){try{if(!v)return;const i=Array.from(v.values()||[]);r.value=S(i),console.log("Nodes updated:",r.value)}catch(i){console.error("Error updating nodes:",i)}}const u={HORIZONTAL:200,VERTICAL:50,MIN_SIBLING_GAP:40};function k(i,a){const t=i.position.x+u.HORIZONTAL;if(a.length===0)return{x:t,y:i.position.y};const e=[...a].sort((I,D)=>I.position.y-D.position.y),n=e.findIndex(I=>Math.abs(I.position.y-i.position.y)<1),c=a.length;if(n===-1)return L(i,a,t);const p=n,h=c-n-1,N=u.VERTICAL*(1+c*.1);if(p<=h){const I=e[0];return{x:t,y:I.position.y-N}}else{const I=e[e.length-1];return{x:t,y:I.position.y+N}}}function L(i,a,t){const e=a.length+1,n=e%2===0,c=Math.floor(e/2),p=u.VERTICAL*(1+e*.1);return a.forEach((h,N)=>{let I;n?N<c?I=i.position.y-(c-N)*p:I=i.position.y+(N-c+1)*p:N<c?I=i.position.y-(c-N)*p:N===c?I=i.position.y:I=i.position.y+(N-c)*p,A(h.id,{x:t,y:I})}),{x:t,y:i.position.y+(n?p*c:0)}}function A(i,a){const t=v.get(i);if(!t)return;const e=a.x-t.position.x,n=a.y-t.position.y,c=Array.from(v.values()),p=B(i,c);v.set(i,{...t,position:a}),p.forEach(h=>{v.set(h.id,{...h,position:{x:h.position.x+e,y:h.position.y+n}})})}function B(i,a){const t=[];return a.filter(n=>n.parentId===i).forEach(n=>{t.push(n),t.push(...B(n.id,a))}),t}function j(i,a){const n=[{x:1,y:0},{x:0,y:1},{x:-1,y:0},{x:0,y:-1}];let c={...i},p=0,h=0;const N=100;for(;h<N;){let I=!1;for(const b of a)if(Z({position:c},b,{width:120,height:40,buffer:20})){I=!0;break}if(!I)return c;const D=n[p];c={x:c.x+D.x*200,y:c.y+D.y*60},h%4===3&&(p=(p+1)%n.length),h++}return c}function Z(i,a,t){const{width:e,height:n,buffer:c}=t,p={left:i.position.x-c,right:i.position.x+e+c,top:i.position.y-c,bottom:i.position.y+n+c},h={left:a.position.x,right:a.position.x+e,top:a.position.y,bottom:a.position.y+n};return!(p.right<h.left||p.left>h.right||p.bottom<h.top||p.top>h.bottom)}function z(i){try{let e=function(n){t.forEach(c=>{c.parentId===n&&(a.push(c.id),e(c.id))})};if(console.log("Removing node:",i),!i||!v)return;const a=[i],t=Array.from(v.values());e(i),ot.transact(()=>{a.forEach(n=>{v.delete(n)}),f.value===i&&(f.value=null)}),w()}catch(a){console.error("Error removing node:",a)}}function J(i,a){const t=v.get(i);t&&v.set(i,{...t,content:a})}function V(i,a){const t=v.get(i);t&&v.set(i,{...t,style:{...t.style,...a}})}function W(){o.undo()}function m(){o.redo()}function O(i){let a=0,t=v.get(i);for(;t!=null&&t.parentId;)a++,t=v.get(t.parentId);return a}const Y=H(()=>{try{return r.value.filter(i=>{var t;if(!i.parentId)return!0;const a=v==null?void 0:v.get(i.parentId);return!((t=a==null?void 0:a.style)!=null&&t.collapsed)})}catch(i){return console.error("Error getting visible nodes:",i),[]}}),P=E(new Set);function X(i){P.value.has(i)?P.value.delete(i):P.value.add(i)}function Q(){f.value=null,P.value.clear()}function dt(){P.value.forEach(i=>{z(i)}),Q()}function ut(i,a){P.value.forEach(t=>{const e=v.get(t);if(e){const n={x:e.position.x+i,y:e.position.y+a};A(t,n)}})}function K(i){Array.from(v.keys()).forEach(a=>{v.delete(a)}),i.forEach(a=>{v.set(a.id,a)})}function nt(){return Array.from(v.values())}function _(){const i=nt(),a=_t(i);K(a)}const R=E([]),F=E("");function G(i){F.value=i,R.value=Qt(Array.from(v.values()),i)}v.observe(()=>{console.log("ymap changed, updating nodes"),w()}),ct(()=>{g(),y()});function ft(i){try{return v.get(i)}catch(a){return console.error("Error getting node:",a),null}}const pt=E(new Set),st={name:`User-${Math.random().toString(36).substr(2,5)}`,color:`#${Math.floor(Math.random()*16777215).toString(16)}`};localStorage.setItem("mindmap-user",JSON.stringify(st));function yt(i){try{console.log("Adding node:",i);let a={...i.position};if(i.parentId){const e=v.get(i.parentId);if(!e)return null;const n=Array.from(v.values()).filter(c=>c.parentId===i.parentId).sort((c,p)=>c.position.y-p.position.y);a=k(e,n)}else a=j(a,Array.from(v.values()));const t={id:Yt(),content:i.content||"新节点",position:a,parentId:i.parentId||null,style:i.style||{backgroundColor:"#ffffff",textColor:"#333333",borderColor:"#ddd"}};return ot.transact(()=>{v.set(t.id,t)}),f.value=t.id,w(),t.id}catch(a){return console.error("Error adding node:",a),null}}function it(i){f.value=i,P.value.clear()}return{isLoading:l,nodes:r,selectedNodeId:f,selectedNodes:P,setSelectedNode:it,toggleNodeSelection:X,clearSelection:Q,visibleNodes:Y,addNode:yt,removeNode:z,moveNode:A,updateNodeContent:J,updateNodeStyle:V,getNode:ft,undo:W,redo:m,getNodeDepth:O,batchDeleteNodes:dt,batchMoveNodes:ut,importNodes:K,exportNodes:nt,applyAutoLayout:_,searchResults:R,searchKeyword:F,updateSearch:G,collaborators:pt}}),ee=(l,r)=>{const f=l.__vccOpts||l;for(const[o,d]of r)f[o]=d;return f},Ct={name:"Node",props:{node:{type:Object,required:!0},scale:{type:Number,default:1}},setup(l){const r=Lt(),f=E(!1),o=E(l.node.content),d=E(null),y=E(null);let s=null;const g=H(()=>r.selectedNodeId===l.node.id||r.selectedNodes.has(l.node.id)),S=H(()=>{var m,O;return{transform:`translate(${l.node.position.x}px, ${l.node.position.y}px)`,backgroundColor:((m=l.node.style)==null?void 0:m.backgroundColor)||"#ffffff",borderColor:((O=l.node.style)==null?void 0:O.borderColor)||"#ddd",zIndex:g.value?2:1}}),w=H(()=>{var m;return{color:((m=l.node.style)==null?void 0:m.textColor)||"#333333"}}),u=H(()=>{var m;return{width:"100%",color:((m=l.node.style)==null?void 0:m.textColor)||"#333333",backgroundColor:"transparent",border:"none",outline:"none",fontSize:"inherit",fontFamily:"inherit",textAlign:"center"}});function k(m){m.button===0&&(s={x:m.clientX,y:m.clientY,nodeX:l.node.position.x,nodeY:l.node.position.y},y.value=m.currentTarget,document.addEventListener("mousemove",L),document.addEventListener("mouseup",A),m.preventDefault())}function L(m){if(!s||!y.value)return;const O=(m.clientX-s.x)/l.scale,Y=(m.clientY-s.y)/l.scale,P=s.nodeX+O,X=s.nodeY+Y;y.value.style.transform=`translate(${P}px, ${X}px)`}function A(m){if(!s)return;const O=(m.clientX-s.x)/l.scale,Y=(m.clientY-s.y)/l.scale;r.moveNode(l.node.id,{x:s.nodeX+O,y:s.nodeY+Y}),s=null,y.value=null,document.removeEventListener("mousemove",L),document.removeEventListener("mouseup",A)}function B(m){m.ctrlKey||m.metaKey?r.toggleNodeSelection(l.node.id):r.setSelectedNode(l.node.id)}function j(){f.value=!0,o.value=l.node.content,Kt(()=>{var m,O;(m=d.value)==null||m.focus(),(O=d.value)==null||O.select()})}function Z(){f.value&&(f.value=!1,o.value!==l.node.content&&r.updateNodeContent(l.node.id,o.value))}function z(){f.value=!1,o.value=l.node.content}function J(m){r.updateNodeStyle(l.node.id,{backgroundColor:m.target.value})}function V(m){r.updateNodeStyle(l.node.id,{textColor:m.target.value})}function W(){var m;r.updateNodeStyle(l.node.id,{collapsed:!((m=l.node.style)!=null&&m.collapsed)})}return ct(()=>{document.removeEventListener("mousemove",L),document.removeEventListener("mouseup",A)}),{isEditing:f,editingContent:o,input:d,isSelected:g,nodeStyle:S,contentStyle:w,inputStyle:u,handleMouseDown:k,handleClick:B,startEditing:j,finishEditing:Z,cancelEditing:z,updateBackgroundColor:J,updateTextColor:V,toggleCollapse:W}}},wt=()=>{$t(l=>({"05e77539":l.node.position.x+"px","6dc8a218":l.node.position.y+"px"}))},Et=Ct.setup;Ct.setup=Et?(l,r)=>(wt(),Et(l,r)):wt;const oe=["data-id"],ne={key:1},se={key:0,class:"node-tools"},ie={class:"style-tools"},le=["value"],re=["value"],ae=["title"];function ce(l,r,f,o,d,y){var s,g,S,w;return T(),M("div",{class:Xt(["node",{selected:o.isSelected}]),style:et(o.nodeStyle),"data-id":f.node.id,onMousedown:r[8]||(r[8]=(...u)=>o.handleMouseDown&&o.handleMouseDown(...u)),onClick:r[9]||(r[9]=rt((...u)=>o.handleClick&&o.handleClick(...u),["stop"])),onDblclick:r[10]||(r[10]=rt((...u)=>o.startEditing&&o.startEditing(...u),["stop"]))},[C("div",{class:"node-content",style:et(o.contentStyle)},[o.isEditing?St((T(),M("input",{key:0,ref:"input","onUpdate:modelValue":r[0]||(r[0]=u=>o.editingContent=u),onBlur:r[1]||(r[1]=(...u)=>o.finishEditing&&o.finishEditing(...u)),onKeydown:[r[2]||(r[2]=Nt((...u)=>o.finishEditing&&o.finishEditing(...u),["enter"])),r[3]||(r[3]=Nt((...u)=>o.cancelEditing&&o.cancelEditing(...u),["esc"]))],style:et(o.inputStyle)},null,36)),[[kt,o.editingContent]]):(T(),M("span",ne,at(f.node.content),1))],4),o.isSelected?(T(),M("div",se,[C("button",{class:"add-child",onClick:r[4]||(r[4]=rt(u=>l.$emit("add-child"),["stop"])),title:"添加子节点"}," + "),C("div",ie,[C("input",{type:"color",value:((s=f.node.style)==null?void 0:s.backgroundColor)||"#ffffff",onInput:r[5]||(r[5]=(...u)=>o.updateBackgroundColor&&o.updateBackgroundColor(...u)),title:"背景颜色"},null,40,le),C("input",{type:"color",value:((g=f.node.style)==null?void 0:g.textColor)||"#333333",onInput:r[6]||(r[6]=(...u)=>o.updateTextColor&&o.updateTextColor(...u)),title:"文字颜色"},null,40,re)]),C("button",{class:"collapse-toggle",onClick:r[7]||(r[7]=rt((...u)=>o.toggleCollapse&&o.toggleCollapse(...u),["stop"])),title:(S=f.node.style)!=null&&S.collapsed?"展开":"折叠"},at((w=f.node.style)!=null&&w.collapsed?"▸":"▾"),9,ae)])):tt("",!0)],46,oe)}const de=ee(Ct,[["render",ce],["__scopeId","data-v-e4c2df0e"]]);function ue({mindmapStore:l,addNode:r,removeNode:f,undo:o,redo:d}){const y=s=>{if(s.target.tagName!=="INPUT"){if((s.metaKey||s.ctrlKey)&&s.key==="z"&&!s.shiftKey&&(s.preventDefault(),o()),(s.metaKey||s.ctrlKey)&&s.key==="z"&&s.shiftKey&&(s.preventDefault(),d()),(s.metaKey||s.ctrlKey)&&s.key==="y"&&(s.preventDefault(),d()),s.key==="Enter"&&!s.shiftKey&&(s.preventDefault(),l.selectedNodeId&&r()),s.key==="Tab"){s.preventDefault();const g=l.nodes.find(S=>S.id===l.selectedNodeId);g!=null&&g.parentId&&r(g.parentId)}if((s.key==="Delete"||s.key==="Backspace")&&l.selectedNodeId&&(s.preventDefault(),f()),s.key==="Escape"&&(s.preventDefault(),l.setSelectedNode(null),l.clearSelection()),s.key.startsWith("Arrow")){s.preventDefault();const g=l.nodes.find(u=>u.id===l.selectedNodeId);if(!g)return;const S=l.nodes;let w=null;switch(s.key){case"ArrowUp":{w=S.filter(u=>u.position.y<g.position.y).sort((u,k)=>{const L=Math.abs(u.position.x-g.position.x),A=Math.abs(k.position.x-g.position.x);return L-A})[0];break}case"ArrowDown":{w=S.filter(u=>u.position.y>g.position.y).sort((u,k)=>{const L=Math.abs(u.position.x-g.position.x),A=Math.abs(k.position.x-g.position.x);return L-A})[0];break}case"ArrowLeft":{w=S.find(u=>u.id===g.parentId);break}case"ArrowRight":{w=S.filter(u=>u.parentId===g.id).sort((u,k)=>u.position.y-k.position.y)[0];break}}w&&l.setSelectedNode(w.id)}}};return At(()=>{window.addEventListener("keydown",y)}),ct(()=>{window.removeEventListener("keydown",y)}),{handleKeydown:y}}const fe={class:"container"},pe={class:"toolbar"},ye={class:"toolbar-left"},ge=["disabled"],he=["disabled"],ve=["disabled"],me={class:"search-box"},be={key:0},Ce={class:"toolbar-right"},xe={class:"status"},Ne={key:0,class:"saving"},Ie={key:1,class:"saved"},we={class:"collaborators"},Ee={key:0,class:"align-tools"},Se={class:"connections",width:1e4,height:1e4},ke=["d"],Ae=["cx","cy"],Te={class:"nodes-container"},_e={__name:"App",setup(l){const r=E(window.innerWidth),f=E(window.innerHeight),o=Lt(),d=H(()=>o.nodes),y=H(()=>o.canUndo),s=H(()=>o.canRedo),g=E(!1),S=H(()=>o.collaborators.size);E({id:"",parentId:null,content:"",position:{x:0,y:0}});const{handleKeydown:w}=ue({mindmapStore:o,addNode:L,removeNode:A,undo:V,redo:W}),u=H(()=>o.selectedNodes),k={HORIZONTAL_SPACING:200,VERTICAL_SPACING:60,NODE_WIDTH:120,NODE_HEIGHT:40,CURVE_OFFSET:50};function L(){console.log("Adding new node");try{const t={x:(window.innerWidth/2-_.value.x)/R.value,y:(window.innerHeight/2-_.value.y)/R.value},e=o.addNode({content:"新节点",position:t});e&&(o.selectedNodeId=e)}catch(t){console.error("Failed to add node:",t)}}function A(){const t=o.selectedNodeId;if(!t){console.log("No node selected");return}try{console.log("Removing node:",t),o.removeNode(t)}catch(e){console.error("Failed to remove node:",e)}}function B(t){var e;if(!t){console.error("No parent node ID provided");return}try{const n=o.getNode(t);if(!n){console.error("Parent node not found:",t);return}const c=((e=o.nodes)==null?void 0:e.value)||[],p=c.filter(I=>I.parentId===t);let h={x:n.position.x+200,y:n.position.y};h=j(h,c);const N=o.addNode({content:"子节点",position:h,parentId:t,style:{backgroundColor:"#ffffff",textColor:"#333333",borderColor:"#ddd"}});console.log("Successfully added child node:",N)}catch(n){console.error("Failed to add child node:",n)}}function j(t,e){let p=0,h=40,N={...t},I=0;for(;I<100;){let D=!1;for(const b of e)if(Z({position:N},b)){D=!0;break}if(!D)return N;p+=Math.PI/4,p>=Math.PI*2&&(p=0,h+=40),N={x:t.x+h*Math.cos(p),y:t.y+h*Math.sin(p)},I++}return N}function Z(t,e){const h={left:t.position.x-40,right:t.position.x+120+40,top:t.position.y-40,bottom:t.position.y+40+40},N={left:e.position.x,right:e.position.x+120,top:e.position.y,bottom:e.position.y+40};return!(h.right<N.left||h.left>N.right||h.bottom<N.top||h.top>N.bottom)}function z(t,e){if(t)try{o.updateNodeContent(t,e)}catch(n){console.error("Failed to update node content:",n)}}function J(t,e){if(t)try{o.updateNodeStyle(t,e)}catch(n){console.error("Failed to update node style:",n)}}function V(){o.undo()}function W(){o.redo()}async function m(){const t=document.querySelectorAll(".node");let e=1/0,n=1/0,c=-1/0,p=-1/0;t.forEach($=>{const x=$.getBoundingClientRect();e=Math.min(e,x.left),n=Math.min(n,x.top),c=Math.max(c,x.right),p=Math.max(p,x.bottom)});const h=50;e-=h,n-=h,c+=h,p+=h;const N=c-e,I=p-n,D=document.createElement("canvas");D.width=N,D.height=I;const b=D.getContext("2d");b.fillStyle="#ffffff",b.fillRect(0,0,N,I),b.translate(-e,-n);const Ot=document.querySelector(".connections"),Pt=new XMLSerializer().serializeToString(Ot),gt=new Image;gt.src="data:image/svg+xml;base64,"+btoa(Pt),await new Promise($=>{gt.onload=$}),b.drawImage(gt,0,0),t.forEach($=>{const x=$.getBoundingClientRect,lt=window.getComputedStyle($);b.save(),b.shadowColor="rgba(0, 0, 0, 0.1)",b.shadowBlur=8,b.shadowOffsetY=2,b.fillStyle=lt.backgroundColor,b.strokeStyle=lt.borderColor,b.lineWidth=1;const U=4;b.beginPath(),b.moveTo(x.left+U,x.top),b.lineTo(x.right-U,x.top),b.quadraticCurveTo(x.right,x.top,x.right,x.top+U),b.lineTo(x.right,x.bottom-U),b.quadraticCurveTo(x.right,x.bottom,x.right-U,x.bottom),b.lineTo(x.left+U,x.bottom),b.quadraticCurveTo(x.left,x.bottom,x.left,x.bottom-U),b.lineTo(x.left,x.top+U),b.quadraticCurveTo(x.left,x.top,x.left+U,x.top),b.closePath(),b.fill(),b.stroke(),b.restore();const xt=$.querySelector("input");xt&&(b.fillStyle=lt.color,b.font=lt.font,b.fillText(xt.value,x.left+8,x.top+20))});const ht=document.createElement("a");ht.download="mindmap.png",ht.href=D.toDataURL("image/png"),ht.click()}function O(){const t={nodes:o.nodes,version:"1.0",timestamp:new Date().toISOString()},e=JSON.stringify(t,null,2),n=new Blob([e],{type:"application/json"}),c=URL.createObjectURL(n),p=document.createElement("a");p.href=c,p.download="mindmap.json",p.click(),URL.revokeObjectURL(c)}zt(()=>d.value,()=>{g.value=!0,setTimeout(()=>{g.value=!1},1e3)},{deep:!0});function Y(){const t=o.exportNodes(),e=Zt(t),n=new Blob([e],{type:"text/markdown;charset=utf-8"});Vt.saveAs(n,"mindmap.md")}async function P(t){const e=t.target.files[0];if(!e)return;const n=await e.text(),c=Jt(n);o.importNodes(c)}const X=E(""),Q=H(()=>o.searchResults);function dt(){o.updateSearch(X.value)}const ut=E(!1),K=E(null);function nt(t){const e=o.getNode(t.parentId);if(!e)return"";const n=e.position.x+k.NODE_WIDTH,c=e.position.y+k.NODE_HEIGHT/2,p=t.position.x,h=t.position.y+k.NODE_HEIGHT/2,I=(p-n)*.5;return`
    M ${n} ${c}
    C ${n+I} ${c}
      ${p-I} ${h}
      ${p} ${h}
  `.trim()}const _=E({x:window.innerWidth/2,y:window.innerHeight/2}),R=E(1),F=E(!1),G=E(null);function ft(t){(t.target.classList.contains("mindmap")||t.target.classList.contains("canvas"))&&(t.preventDefault(),F.value=!0,G.value={x:t.clientX,y:t.clientY},t.target.style.cursor="grabbing")}function pt(t){if(!F.value||!G.value)return;const e=t.clientX-G.value.x,n=t.clientY-G.value.y;_.value={x:_.value.x+e,y:_.value.y+n},G.value={x:t.clientX,y:t.clientY}}function st(t){if(F.value){F.value=!1,G.value=null;const e=t.target;(e.classList.contains("mindmap")||e.classList.contains("canvas"))&&(e.style.cursor="grab")}}function yt(t){t.preventDefault();const e=.1,n=.1,c=3,p=t.deltaY>0?-.1:e,h=Math.max(n,Math.min(c,R.value+p)),N=t.currentTarget.getBoundingClientRect(),I=t.clientX-N.left,D=t.clientY-N.top,b=h-R.value;_.value={x:_.value.x-(I-_.value.x)*(b/R.value),y:_.value.y-(D-_.value.y)*(b/R.value)},R.value=h}At(()=>{window.addEventListener("keydown",w),window.addEventListener("resize",it);const t=document.querySelector(".mindmap");t&&(_.value={x:t.clientWidth/2,y:t.clientHeight/2})});function it(){r.value=window.innerWidth,f.value=window.innerHeight}ct(()=>{window.removeEventListener("keydown",w),window.removeEventListener("resize",it)});const i=H(()=>{var t;return((t=u.value)==null?void 0:t.size)>1});function a(t){var n;if(!((n=u.value)!=null&&n.size))return;const e={left:"LEFT",center:"CENTER",right:"RIGHT",top:"TOP",bottom:"BOTTOM"}[t];e&&o.alignSelectedNodes(e)}return(t,e)=>(T(),M("div",fe,[C("div",pe,[C("div",ye,[C("button",{onClick:L,class:"toolbar-button",title:"添加新节点"}," 添加节点 "),C("button",{onClick:A,class:"toolbar-button",disabled:!vt(o).selectedNodeId,title:"删除选中节点"}," 删除节点 ",8,ge),C("button",{onClick:V,disabled:!y.value},"撤销",8,he),C("button",{onClick:W,disabled:!s.value},"重做",8,ve),C("button",{onClick:m},"导出PNG"),C("button",{onClick:O},"导出JSON"),C("button",{onClick:e[0]||(e[0]=(...n)=>t.applyAutoLayout&&t.applyAutoLayout(...n))},"自动布局"),C("button",{onClick:Y},"导出 Markdown"),C("input",{type:"file",accept:".md",ref:"fileInput",style:{display:"none"},onChange:P},null,544),C("button",{onClick:e[1]||(e[1]=n=>t.$refs.fileInput.click())},"导入 Markdown"),C("div",me,[St(C("input",{type:"text","onUpdate:modelValue":e[2]||(e[2]=n=>X.value=n),onInput:dt,placeholder:"搜索节点..."},null,544),[[kt,X.value]]),Q.value.length?(T(),M("span",be," 找到 "+at(Q.value.length)+" 个结果 ",1)):tt("",!0)])]),C("div",Ce,[C("div",xe,[g.value?(T(),M("span",Ne,"保存中...")):(T(),M("span",Ie,"已保存")),C("span",we,"在线用户: "+at(S.value),1)]),i.value?(T(),M("div",Ee,[C("button",{class:"toolbar-button",onClick:e[3]||(e[3]=n=>a("left")),title:"左对齐"}," ⇤ "),C("button",{class:"toolbar-button",onClick:e[4]||(e[4]=n=>a("center")),title:"居中对齐"}," ⇔ "),C("button",{class:"toolbar-button",onClick:e[5]||(e[5]=n=>a("right")),title:"右对齐"}," ⇥ "),C("button",{class:"toolbar-button",onClick:e[6]||(e[6]=n=>a("top")),title:"上对齐"}," ⇡ "),C("button",{class:"toolbar-button",onClick:e[7]||(e[7]=n=>a("bottom")),title:"下对齐"}," ⇣ ")])):tt("",!0)])]),C("div",{class:"mindmap",onMousedown:ft,onMousemove:pt,onMouseup:st,onMouseleave:st,onWheel:yt},[C("div",{class:"canvas",style:et({transform:`translate(${_.value.x}px, ${_.value.y}px) scale(${R.value})`,cursor:F.value?"grabbing":"grab"})},[e[8]||(e[8]=C("div",{class:"grid-background"},null,-1)),(T(),M("svg",Se,[(T(!0),M(mt,null,It(vt(o).visibleNodes,n=>(T(),M("g",{key:`connection-${n.id}`},[n.parentId?(T(),M(mt,{key:0},[C("path",{d:nt(n),stroke:"#409eff","stroke-width":"2",fill:"none"},null,8,ke),C("circle",{cx:n.position.x,cy:n.position.y+k.NODE_HEIGHT/2,r:"3",fill:"#409eff"},null,8,Ae)],64)):tt("",!0)]))),128))])),C("div",Te,[(T(!0),M(mt,null,It(vt(o).visibleNodes,n=>(T(),Wt(de,{key:n.id,node:n,scale:R.value,onAddChild:c=>B(n.id),onUpdateContent:c=>z(n.id,c),onUpdateStyle:c=>J(n.id,c)},null,8,["node","scale","onAddChild","onUpdateContent","onUpdateStyle"]))),128))])],4),ut.value?(T(),M("div",{key:0,class:"selection-rect",style:et({left:`${K.value.left}px`,top:`${K.value.top}px`,width:`${K.value.width}px`,height:`${K.value.height}px`})},null,4)):tt("",!0)],32)]))}},Dt=qt(_e),Me=jt();Dt.use(Me);Dt.mount("#app");
